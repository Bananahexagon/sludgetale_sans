const P=e=>{const t=(s,n,a)=>{s()?(n(),e.tick(),requestAnimationFrame(()=>t(s,n,a))):a()},g=(s,n)=>new Promise(a=>{t(s,n,a)}),c=(s,n,a,h)=>{a<s?(n(a),e.tick(),requestAnimationFrame(()=>c(s,n,a+1,h))):h()},p=(s,n,a=0)=>new Promise(h=>{c(s,n,a,h)}),i=s=>{s(),e.tick(),requestAnimationFrame(()=>i(s))};return{frameWhile:g,frameFor:p,frameLoop:i}},z=[{type:"image",name:"soul",src:"./assets/images/soul.png"},{type:"image",name:"soul_blue",src:"./assets/images/soul_blue.png"},{type:"image",name:"commands",src:"./assets/images/commands.png"},{type:"image",name:"back",src:"./assets/images/back.png"},{type:"image",name:"sans",src:"./assets/images/sans.png"},{type:"image",name:"hp_kr_purple",src:"./assets/images/hp_kr_purple.png"},{type:"image",name:"determination_white",src:"./assets/images/font/determination_white.png"},{type:"image",name:"determination_red",src:"./assets/images/font/determination_red.png"},{type:"image",name:"determination_orange",src:"./assets/images/font/determination_orange.png"},{type:"image",name:"determination_blue",src:"./assets/images/font/determination_blue.png"},{type:"image",name:"determination_yellow",src:"./assets/images/font/determination_yellow.png"},{type:"image",name:"status_white",src:"./assets/images/font/status_white.png"},{type:"image",name:"status_red",src:"./assets/images/font/status_red.png"},{type:"image",name:"status_orange",src:"./assets/images/font/status_orange.png"},{type:"image",name:"status_blue",src:"./assets/images/font/status_blue.png"},{type:"image",name:"status_yellow",src:"./assets/images/font/status_yellow.png"},{type:"image",name:"status_purple",src:"./assets/images/font/status_purple.png"},{type:"image",name:"kr_white",src:"./assets/images/kr_white.png"},{type:"image",name:"hp_white",src:"./assets/images/hp_white.png"},{type:"image",name:"bone_head_white",src:"./assets/images/bone_head_white.png"},{type:"image",name:"bananahexagon",src:"./assets/images/normal_icon.png"},{type:"image",name:"death_0",src:"./assets/images/death_0.png"},{type:"image",name:"death_1",src:"./assets/images/death_1.png"},{type:"image",name:"death_2",src:"./assets/images/death_2.png"},{type:"image",name:"death_3",src:"./assets/images/death_3.png"},{type:"image",name:"death_4",src:"./assets/images/death_4.png"},{type:"audio",name:"damage",src:"./assets/audios/p_damage.wav"},{type:"audio",name:"heartbreak_1",src:"./assets/audios/heartbreak_1.wav"},{type:"audio",name:"heartbreak_2",src:"./assets/audios/heartbreak_2.wav"}],L=async e=>{const t={},g={},c={},p=z,i=[];return console.log(p),p.forEach(s=>i.push(new Promise(n=>{switch(s.type){case"image":{const a=new Image;a.src=s.src,a.onload=()=>{t[s.name]=a,n()}}break;case"audio":{const a=new Audio(s.src);a.autoplay=!1,a.muted=!0,console.log(a),a.addEventListener("loadeddata",()=>{a.muted=!1,(async()=>{const l=await(await fetch(s.src)).arrayBuffer();g[s.name]={ctx:await e.decodeAudioData(l),data:a,time:1/0},a.onload=()=>n()})().then(n)})}break;case"font":(async()=>{const l=await(await(await fetch(s.src)).text()).match(/url\(.+?\)/g);if(!l)throw new Error("フォントが見つかりませんでした");const d=[];l.forEach(o=>{d.push((async()=>{const r=new FontFace(s.name,o);await r.load(),c[s.name]=r,await document.fonts.add(r)})())}),Promise.all(d)})().then(n);break}}))),await Promise.all(i),{Images:t,Audios:g,Fonts:c}},y=e=>Math.sin(e/360*Math.PI*2),m=e=>Math.cos(e/360*Math.PI*2),A=(e,t,g,c,p,i)=>{const s=(l,d,o,r=0,_=100,f=1,u="center",w,x=!1)=>{if(x){const b=g[l],[$,v,q,M]=w===void 0?[0,0,b.width,b.height]:[w.left,w.top,w.width,w.height];switch(t.globalAlpha=f,u){case"center":t.save(),t.translate(d*p.display_quality,-o*p.display_quality+e.height),t.rotate(r*Math.PI/180),t.drawImage(b,$,v,q,M,-q*_/200*p.display_quality,-M*_/200*p.display_quality,q*_/100*p.display_quality,M*_/100*p.display_quality),t.restore();break;case"start":t.save(),t.translate(d*p.display_quality,-o*p.display_quality+e.height),t.rotate(r*Math.PI/180),t.drawImage(b,$,v,q,M,0,0,q*_/100*p.display_quality,M*_/100*p.display_quality),t.restore()}}else{const b=(m(i.d)*d-y(i.d)*o+i.x)*i.size/100,$=(y(i.d)*d+m(i.d)*o+i.y)*i.size/100,v=r+i.d;s(l,b,$,v,_*i.size/100,f,u,w,!0)}};return{stamp:s,drawRect:(l,d,o,r,_,f=0,u="center")=>{switch(t.globalAlpha=1,t.save(),u){case"center++":t.translate(l*p.display_quality,-d*p.display_quality+e.height),t.rotate(f*Math.PI/180),t.beginPath(),t.rect(-o/2*p.display_quality,-r/2*p.display_quality,o*p.display_quality,r*p.display_quality);break;case"center":t.translate((l-o/2)*p.display_quality,-(d-r/2)*p.display_quality+e.height),t.rotate(f*Math.PI/180),t.beginPath(),t.rect(0,0,o*p.display_quality,-r*p.display_quality);break;case"start":default:t.translate(l*p.display_quality,-d*p.display_quality+e.height),t.rotate(f*Math.PI/180),t.beginPath(),t.rect(0,0,o*p.display_quality,-r*p.display_quality);break}t.fillStyle=_,t.fill(),t.restore()},drawLine:(l,d,o,r,_,f,u=0)=>{switch(t.globalAlpha=1,t.beginPath(),u){case 0:t.moveTo((l-r*Math.sin(o)/2)*p.display_quality,-(d+r*Math.cos(o)/2)*p.display_quality+e.height),t.lineTo((l+r*Math.sin(o)/2)*p.display_quality,-(d-r*Math.cos(o)/2)*p.display_quality+e.height);break;case 1:t.moveTo(l*p.display_quality,-d*p.display_quality+e.height),t.lineTo((l+r*Math.sin(o))*p.display_quality,-(d-r*Math.cos(o))*p.display_quality+e.height);break}t.strokeStyle=f,t.lineWidth=_*p.display_quality,t.stroke()},drawText:(l,d,o,r,_,f="serif",u="left")=>{t.globalAlpha=1;const[w,x]=[d*p.display_quality,-o*p.display_quality+e.height];t.font=`${r*p.display_quality}px ${f}`,t.textAlign=u,t.fillStyle=_,t.fillText(l,w,x)}}},E=e=>{class t{constructor(c,p,i=0,s=100,n="",a=!1,h){this.x=c,this.y=p,this.d=i,this.size=s,this.costume=n,this.visible=a,this.act_=h}stamp(){this.visible&&e.stamp(this.costume,this.x,this.y,this.d,this.size)}move(c){this.x+=y(this.d)*c,this.y+=m(this.d)*c}act(){(this.act_||(()=>{}))(this)}}return t},I=(e,t,g)=>({raw_to_stage:(p,i,s=0)=>{const n=e.getBoundingClientRect(),a=((p-n.left)/g.size*100-g.x)*t.stage_width/t.display_width,h=(t.display_height-((i-n.top)/g.size*100-g.y))*t.stage_height/t.display_height,l=s+g.d;return{x:a,y:h,d:l}}}),D=e=>{const t=new(window.AudioContext||window.webkitAudioContext);return{play:(i,s=0)=>{s<=e[i].time&&(e[i].data.currentTime=0,e[i].data.play(),e[i].time=0)},play_ctx:(i,s=0)=>{if(s<=e[i].time){const n=t.createBufferSource();n.buffer=e[i].ctx,n.connect(t.destination),n.start(0),e[i].time=0}},tick:()=>{for(const i in e)e[i].time++}}},F=async e=>{const t=document.getElementById(e.canvas_name);t.height=e.stage_height*e.display_quality,t.width=e.stage_width*e.display_quality;const g=t.getContext("2d"),c=new(window.AudioContext||window.webkitAudioContext),{Images:p,Audios:i,Fonts:s}=await L(c),n={up:!1,down:!1,left:!1,right:!1,z:!1,x:!1,c:!1,d:!1},a={x:0,y:0,clicking:!1,is_in_rect(w,x,b,$,v="center"){switch(v){case"center":return w-b/2<this.x&&this.x<w+b/2&&x-$/2<this.y&&this.y<x+$/2;case"start":default:return w<this.x&&this.x<w+b&&x<this.y&&this.y<x+$}}},h={canvas:{size:100,x:0,y:0,d:0}},l=A(t,g,p,s,e,h.canvas),d=D(i),o=E(l);g.imageSmoothingEnabled=!1;const r=I(t,e,h.canvas);window.addEventListener("keydown",w=>{switch(w.key){case"ArrowUp":n.up=!0;break;case"ArrowDown":n.down=!0;break;case"ArrowLeft":n.left=!0;break;case"ArrowRight":n.right=!0;break;case"z":case"Z":n.z=!0;break;case"x":case"X":n.x=!0;break;case"c":case"C":n.c=!0;break;case"d":case"D":n.d=!0;break}}),window.addEventListener("keyup",w=>{switch(w.key){case"ArrowUp":n.up=!1;break;case"ArrowDown":n.down=!1;break;case"ArrowLeft":n.left=!1;break;case"ArrowRight":n.right=!1;break;case"z":case"Z":n.z=!1;break;case"x":case"X":n.x=!1;break;case"c":case"C":n.c=!1;break;case"d":case"D":n.d=!1;break}}),t.addEventListener("mousedown",w=>{a.clicking=!0;const x=r.raw_to_stage(w.x,w.y);a.x=x.x,a.y=x.y}),t.addEventListener("mousemove",w=>{const x=r.raw_to_stage(w.x,w.y);a.x=x.x,a.y=x.y}),t.addEventListener("mouseup",w=>{a.clicking=!1;const x=r.raw_to_stage(w.x,w.y);a.x=x.x,a.y=x.y});const{frameWhile:_,frameFor:f,frameLoop:u}=P(d);return{canvas:t,ctx:g,Images:p,Audios:i,Fonts:s,inputKeys:n,inputMouse:a,props:h,cLib:l,aLib:d,Sprite:o,for:f,while:_,loop:u}},R=2,S=640,B=480,C=800,G=400,j="canvas",T={display_quality:R,stage_width:S,stage_height:B,display_width:C,display_height:G,canvas_name:j},W=(e,t,g,c)=>{let p={};const i=class k extends g{constructor(h,l,d,o,r,_,f,u,w,x){super(h,l,d,o,void 0,!0),this.start_x=h,this.start_y=l,this.start_d=d,this.move_x=_,this.move_y=f,this.move_d=u,this.start_len=r,this.move_len=w,this.len=r,this.age=0,this.id=k.current_id,this.width=o,p[this.id]=this,k.current_id++}move_self(){this.age++,this.x=this.start_x+k.get_move(this.move_x,this.age),this.y=this.start_y+k.get_move(this.move_y,this.age),this.d=this.start_d+k.get_move(this.move_d,this.age),this.len=this.start_len+k.get_move(this.move_len,this.age)}draw(){m(this.d),e.stamp("bone_head_white",this.x+m(this.d)*this.width*8/6,this.y-y(this.d)*this.width*8/6,this.d+180,this.width*100/6,1,"start"),e.drawRect(this.x+y(this.d)*this.width*6/6,this.y+m(this.d)*this.width*6/6,this.width,this.len+this.width*2/6,"white",this.d,"start"),e.stamp("bone_head_white",this.x+y(this.d)*(this.len+this.width*14/6)-m(this.d)*this.width*2/6,this.y+m(this.d)*(this.len+this.width*14/6)+y(this.d)*this.width*2/6,this.d,this.width*100/6,1,"start")}judge(){{const h=c.soul.x-this.x,l=c.soul.y-this.y,d=h*m(this.d)+l*-y(this.d),o=l*m(this.d)+h*y(this.d);this.len+this.width*14/6>o&&o>0&&this.width>d&&d>0&&c.damage(2)}}static process(){for(const h in p){const l=p[h];l.move_self(),l.draw(),l.judge()}}static get_move(h,l){if(typeof h=="number")return h*l;switch(h.type){case"sin":case"cos":return y(h.cycle*l)*h.amp;case"custom":return h.fn(l)}}};i.current_id=0;let s=i;return{boneDict:p,normal:s,process:()=>{s.process()}}},K={height_basic:15,width_basic:2,name:"determination"},U={left:10,up:34,width:6,height:9,gap:0},X={left:20,up:34,width:6,height:9,gap:0},Z={left:30,up:34,width:6,height:9,gap:0},H={left:40,up:34,width:6,height:9,gap:0},V={left:50,up:34,width:6,height:9,gap:0},J={left:60,up:34,width:6,height:9,gap:0},N={left:70,up:34,width:6,height:9,gap:0},O={left:80,up:34,width:6,height:9,gap:0},Q={left:90,up:34,width:6,height:9,gap:0},Y={left:100,up:34,width:6,height:9,gap:0},tt={left:110,up:34,width:6,height:9,gap:0},et={left:120,up:34,width:6,height:9,gap:0},st={left:130,up:34,width:7,height:9,gap:0},it={left:140,up:34,width:6,height:9,gap:0},ht={left:150,up:34,width:6,height:9,gap:0},at={left:0,up:50,width:6,height:9,gap:0},nt={left:10,up:50,width:6,height:9,gap:0},pt={left:20,up:50,width:6,height:9,gap:0},lt={left:30,up:50,width:6,height:9,gap:0},dt={left:40,up:50,width:6,height:9,gap:0},ot={left:50,up:50,width:6,height:9,gap:0},gt={left:60,up:50,width:6,height:9,gap:0},rt={left:70,up:50,width:7,height:9,gap:0},ct={left:80,up:50,width:6,height:9,gap:0},ut={left:90,up:50,width:6,height:9,gap:0},wt={left:100,up:50,width:6,height:9,gap:0},ft={left:10,up:68,width:6,height:7,gap:2},_t={left:20,up:66,width:6,height:9,gap:0},yt={left:30,up:68,width:6,height:7,gap:2},mt={left:40,up:66,width:6,height:9,gap:0},xt={left:50,up:68,width:6,height:7,gap:2},bt={left:60,up:66,width:6,height:9,gap:0},$t={left:70,up:68,width:6,height:10,gap:5},kt={left:80,up:66,width:6,height:9,gap:0},vt={left:90,up:65,width:6,height:10,gap:-1},qt={left:100,up:65,width:6,height:13,gap:2},Mt={left:110,up:66,width:6,height:9,gap:0},Pt={left:120,up:66,width:6,height:9,gap:0},zt={left:130,up:68,width:7,height:7,gap:2},Lt={left:140,up:68,width:6,height:7,gap:2},At={left:150,up:68,width:6,height:7,gap:2},Et={left:0,up:84,width:6,height:10,gap:5},It={left:10,up:84,width:6,height:10,gap:5},Dt={left:20,up:84,width:6,height:7,gap:2},Ft={left:30,up:84,width:6,height:7,gap:2},Rt={left:40,up:82,width:6,height:9,gap:0},St={left:50,up:84,width:6,height:7,gap:2},Bt={left:60,up:84,width:6,height:7,gap:2},Ct={left:70,up:84,width:7,height:7,gap:2},Gt={left:80,up:84,width:6,height:7,gap:2},jt={left:90,up:84,width:6,height:10,gap:5},Tt={left:100,up:84,width:6,height:7,gap:2},Wt={left:0,up:0,width:1,height:1,gap:0},Kt={left:150,up:82,width:6,height:9,gap:0},Ut={left:40,up:0,width:6,height:13,gap:0},Xt={left:150,up:61,width:4,height:1,gap:14},Zt={0:{left:0,up:18,width:6,height:9,gap:0},1:{left:10,up:18,width:6,height:9,gap:0},2:{left:20,up:18,width:6,height:9,gap:0},3:{left:30,up:18,width:6,height:9,gap:0},4:{left:40,up:18,width:6,height:9,gap:0},5:{left:50,up:18,width:6,height:9,gap:0},6:{left:60,up:18,width:6,height:9,gap:0},7:{left:70,up:18,width:6,height:9,gap:0},8:{left:80,up:18,width:6,height:9,gap:0},9:{left:90,up:18,width:6,height:9,gap:0},props:K,A:U,B:X,C:Z,D:H,E:V,F:J,G:N,H:O,I:Q,J:Y,K:tt,L:et,M:st,N:it,O:ht,P:at,Q:nt,R:pt,S:lt,T:dt,U:ot,V:gt,W:rt,X:ct,Y:ut,Z:wt,a:ft,b:_t,c:yt,d:mt,e:xt,f:bt,g:$t,h:kt,i:vt,j:qt,k:Mt,l:Pt,m:zt,n:Lt,o:At,p:Et,q:It,r:Dt,s:Ft,t:Rt,u:St,v:Bt,w:Ct,x:Gt,y:jt,z:Tt,space:Wt,irregular:Kt,"!":{left:10,up:1,width:4,height:10,gap:-1},'"':{left:20,up:2,width:5,height:4,gap:-5},"#":{left:30,up:2,width:7,height:9,gap:0},$:Ut,"%":{left:50,up:2,width:7,height:9,gap:0},"&":{left:60,up:2,width:7,height:9,gap:0},"'":{left:70,up:2,width:2,height:4,gap:-5},"(":{left:80,up:2,width:4,height:9,gap:0},")":{left:90,up:2,width:4,height:9,gap:0},"*":{left:100,up:4,width:8,height:5,gap:0},"+":{left:110,up:4,width:6,height:5,gap:0},",":{left:120,up:9,width:2,height:4,gap:7},"-":{left:130,up:6,width:5,height:1,gap:0},".":{left:140,up:9,width:2,height:2,gap:7},"/":{left:150,up:2,width:6,height:10,gap:1},":":{left:100,up:20,width:2,height:7,gap:2},";":{left:110,up:20,width:2,height:9,gap:4},"<":{left:120,up:18,width:5,height:9,gap:0},"=":{left:130,up:21,width:5,height:3,gap:0},">":{left:140,up:18,width:5,height:9,gap:0},"?":{left:150,up:18,width:6,height:9,gap:0},"@":{left:0,up:34,width:6,height:9,gap:0},"[":{left:110,up:50,width:4,height:9,gap:0},"\\":{left:120,up:50,width:6,height:10,gap:1},"]":{left:130,up:50,width:4,height:9,gap:0},"^":{left:140,up:49,width:6,height:4,gap:-5},_:Xt,"`":{left:10,up:68,width:3,height:2,gap:2},"{":{left:110,up:82,width:5,height:9,gap:0},"|":{left:120,up:82,width:2,height:9,gap:0},"}":{left:130,up:82,width:5,height:9,gap:0},"~":{left:140,up:85,width:7,height:2,gap:-1}},Ht={height_basic:6,width_basic:1,name:"status"},Vt={left:6,up:14,width:4,height:5,gap:0},Jt={left:12,up:14,width:4,height:5,gap:0},Nt={left:18,up:14,width:4,height:5,gap:0},Ot={left:24,up:14,width:4,height:5,gap:0},Qt={left:30,up:14,width:4,height:5,gap:0},Yt={left:36,up:14,width:4,height:5,gap:0},te={left:42,up:14,width:4,height:5,gap:0},ee={left:48,up:14,width:4,height:5,gap:0},se={left:54,up:14,width:4,height:5,gap:0},ie={left:60,up:14,width:4,height:5,gap:0},he={left:66,up:14,width:4,height:5,gap:0},ae={left:72,up:14,width:4,height:5,gap:0},ne={left:78,up:14,width:5,height:5,gap:0},pe={left:84,up:14,width:4,height:5,gap:0},le={left:90,up:14,width:4,height:5,gap:0},de={left:0,up:21,width:4,height:5,gap:0},oe={left:6,up:21,width:4,height:5,gap:0},ge={left:12,up:21,width:4,height:5,gap:0},re={left:18,up:21,width:4,height:5,gap:0},ce={left:24,up:21,width:4,height:5,gap:0},ue={left:30,up:21,width:4,height:5,gap:0},we={left:36,up:21,width:4,height:5,gap:0},fe={left:42,up:21,width:5,height:5,gap:0},_e={left:48,up:21,width:4,height:5,gap:0},ye={left:54,up:21,width:4,height:5,gap:0},me={left:60,up:21,width:4,height:5,gap:0},xe={left:6,up:28,width:4,height:5,gap:0},be={left:12,up:28,width:4,height:5,gap:0},$e={left:18,up:28,width:4,height:5,gap:0},ke={left:24,up:28,width:4,height:5,gap:0},ve={left:30,up:28,width:4,height:5,gap:0},qe={left:36,up:28,width:4,height:5,gap:0},Me={left:42,up:28,width:4,height:5,gap:0},Pe={left:48,up:28,width:4,height:5,gap:0},ze={left:54,up:28,width:4,height:5,gap:0},Le={left:60,up:28,width:4,height:5,gap:0},Ae={left:66,up:28,width:4,height:5,gap:0},Ee={left:72,up:28,width:4,height:5,gap:0},Ie={left:78,up:28,width:5,height:5,gap:0},De={left:84,up:28,width:4,height:5,gap:0},Fe={left:90,up:28,width:4,height:5,gap:0},Re={left:0,up:35,width:4,height:5,gap:0},Se={left:6,up:35,width:4,height:5,gap:0},Be={left:12,up:35,width:4,height:5,gap:0},Ce={left:18,up:35,width:4,height:5,gap:0},Ge={left:24,up:35,width:4,height:5,gap:0},je={left:30,up:35,width:4,height:5,gap:0},Te={left:36,up:35,width:4,height:5,gap:0},We={left:42,up:35,width:5,height:5,gap:0},Ke={left:48,up:35,width:4,height:5,gap:0},Ue={left:54,up:35,width:4,height:5,gap:0},Xe={left:60,up:35,width:4,height:5,gap:0},Ze={left:0,up:0,width:4,height:1,gap:0},He={left:90,up:35,width:4,height:5,gap:0},Ve={left:24,up:0,width:5,height:5,gap:0},Je={left:90,up:25,width:4,height:1,gap:4},Ne={0:{left:0,up:7,width:4,height:5,gap:0},1:{left:6,up:7,width:4,height:5,gap:0},2:{left:12,up:7,width:4,height:5,gap:0},3:{left:18,up:7,width:4,height:5,gap:0},4:{left:24,up:7,width:4,height:5,gap:0},5:{left:30,up:7,width:4,height:5,gap:0},6:{left:36,up:7,width:4,height:5,gap:0},7:{left:42,up:7,width:4,height:5,gap:0},8:{left:48,up:7,width:4,height:5,gap:0},9:{left:54,up:7,width:4,height:5,gap:0},props:Ht,A:Vt,B:Jt,C:Nt,D:Ot,E:Qt,F:Yt,G:te,H:ee,I:se,J:ie,K:he,L:ae,M:ne,N:pe,O:le,P:de,Q:oe,R:ge,S:re,T:ce,U:ue,V:we,W:fe,X:_e,Y:ye,Z:me,a:xe,b:be,c:$e,d:ke,e:ve,f:qe,g:Me,h:Pe,i:ze,j:Le,k:Ae,l:Ee,m:Ie,n:De,o:Fe,p:Re,q:Se,r:Be,s:Ce,t:Ge,u:je,v:Te,w:We,x:Ke,y:Ue,z:Xe,space:Ze,irregular:He,"!":{left:6,up:0,width:4,height:5,gap:0},'"':{left:12,up:0,width:3,height:2,gap:0},"#":{left:18,up:0,width:5,height:5,gap:0},$:Ve,"%":{left:30,up:1,width:4,height:4,gap:1},"&":{left:36,up:0,width:5,height:5,gap:0},"'":{left:42,up:0,width:1,height:2,gap:-3},"(":{left:48,up:0,width:3,height:5,gap:0},")":{left:54,up:0,width:3,height:5,gap:0},"*":{left:60,up:0,width:5,height:5,gap:0},"+":{left:66,up:0,width:5,height:5,gap:0},",":{left:72,up:3,width:1,height:2,gap:3},"-":{left:78,up:2,width:5,height:1,gap:0},".":{left:84,up:4,width:1,height:1,gap:4},"/":{left:90,up:1,width:4,height:4,gap:1},":":{left:60,up:8,width:1,height:3,gap:0},";":{left:66,up:8,width:1,height:4,gap:1},"<":{left:72,up:7,width:3,height:5,gap:0},"=":{left:78,up:8,width:5,height:3,gap:0},">":{left:84,up:7,width:3,height:5,gap:0},"?":{left:90,up:7,width:4,height:5,gap:0},"@":{left:0,up:14,width:4,height:5,gap:0},"[":{left:66,up:21,width:4,height:5,gap:0},"\\":{left:72,up:22,width:4,height:4,gap:1},"]":{left:78,up:21,width:4,height:5,gap:0},"^":{left:84,up:21,width:5,height:3,gap:-1},_:Je,"`":{left:0,up:27,width:1,height:2,gap:-5},"{":{left:66,up:35,width:3,height:5,gap:0},"|":{left:72,up:35,width:1,height:5,gap:0},"}":{left:78,up:35,width:3,height:5,gap:0},"~":{left:84,up:35,width:4,height:2,gap:-3}},Oe=(e,t)=>{const g={en:Zt,status:Ne};let c={};class p{constructor(h){this.name=h}delete(){delete c[this.name]}}class i extends p{constructor(h,l,d,o,r,_,f){super(h),this._={all_str:f.reduce((u,w)=>u+w.str,""),now:[{str:"",color:f[0].color,spacing_x:f[0].spacing_x,spacing_y:f[0].spacing_y}],len_allow:0,count:0,current_char:0,current_char_true:0},this.x=l,this.y=d,this.direction=o,this.size=r,this.data=f,this.font=(u=>{switch(u){case"status":return g.status;default:return g.en}})(_),c[h]=this,this.process()}write(){const h=this.size,l=this.direction*Math.PI/180,d=this._.now.reduce((u,w)=>u+w.str.length,0);let o=0,r=0,_=0;const f=u=>u in this.font?this.font[u]:this.font.space;return this._.now.forEach(u=>{u.str.split("").forEach(x=>{const b=f(x);x==`
`?(o=0,r+=this.font.props.height_basic+u.spacing_y):(e.stamp(this.font.props.name+"_"+u.color,this.x+(Math.cos(l)*o-Math.sin(l)*(r+b.gap/2))*h/100,this.y+(Math.sin(l)*o+Math.cos(l)*(r+b.gap/2))*h/100,this.direction,h,1,"start",{left:b.left,top:b.up,width:b.width,height:b.height}),_+1<d&&(o+=b.width+this.font.props.width_basic+u.spacing_x)),_++})}),this}process(){const h=this.data.reduce((l,d)=>l+d.str.length,0);if(this._.len_allow==h&&t.z){delete c[this.name];return}else t.x?(this._.len_allow=h,this._.current_char=h):this._.len_allow<h&&(this._.len_allow+=1/this.data[this._.count].speed,this._.current_char+=1/this.data[this._.count].speed);for(;this._.current_char_true<Math.min(this._.len_allow,h);)for(this._.now[this._.count].str+=this.data[this._.count].str[this._.now[this._.count].str.length],this._.current_char_true++;this.data[this._.count].str.length<=this._.now[this._.count].str.length&&this._.count+1<this.data.length;)this._.count++,this._.now.push({str:"",color:this.data[this._.count].color===void 0?"white":this.data[this._.count].color,spacing_x:this.data[this._.count].spacing_x,spacing_y:this.data[this._.count].spacing_y}),this._.current_char-=this.data[this._.count].str.length}}class s extends p{constructor(h,l,d,o,r,_,f,u,w,x,b){super(h),this.str_now="",this.len_now=0,this.str=l,this.x=d,this.y=o,this.direction=r,this.size=_,this.color=f,this.spacing_x=u,this.spacing_y=w,this.speed=x,this.font=($=>{switch($){case"status":return g.status;default:return g.en}})(b),this.len_allow=0,c[h]=this,this.process()}write(){const h=this.str_now,l=this.size,d=this.direction*Math.PI/180;let o,r;[o,r]=[0,0];const _=f=>f in this.font?this.font[f]:this.font.space;for(let f=0;f<h.length;f++){const u=_(h[f]);h[f]==`
`?(o=0,r+=this.font.props.height_basic+this.spacing_y):(e.stamp(this.font.props.name+"_"+(this.color?this.color:"white"),this.x+(Math.cos(d)*o-Math.sin(d)*(r-u.gap))*l/100,this.y+(Math.sin(d)*o+Math.cos(d)*(r-u.gap))*l/100,this.direction,l,1,"start",{left:u.left,top:u.up,width:u.width,height:u.height}),f+1<h.length&&(o+=u.width+this.font.props.width_basic+this.spacing_x))}return this}process(){if(this.len_allow==this.str.length&&t.z){delete c[this.name];return}else t.x?this.len_allow=this.str.length:this.len_allow<this.str.length&&(this.len_allow+=1/this.speed);for(;this.str_now.length<Math.min(this.len_allow,this.str.length);)this.str_now+=this.str[this.str_now.length]}}return{Super:i,Plane:s,process:()=>{for(const a in c)c[a].process()},dict:c}},Qe=(e,t)=>{class g{constructor(s,n,a,h,l,d,o=4){this.dx=s,this.dy=n,this.dd=a,this.len=h,this.align=l,this.width=o,this.soul_size=6,this.relative=d||(()=>{const r=this.dd,_=t.x-this.dx;return(t.y-this.dy)*m(r)+_*y(r)>0?"plus":"minus"})()}judge(){const s=this.dd,n=t.x-this.dx,a=t.y-this.dy,h=n*m(s)+a*-y(s),l=a*m(s)+n*y(s);if(this.len/2>h&&h>-this.len/2){if(this.relative=="minus"&&l>-(this.width/2+this.soul_size)||this.relative=="plus"&&this.width/2+this.soul_size>l){const d=h*m(-s)+(this.width/2+this.soul_size)*(this.relative=="minus"?1:-1)*y(-s),o=(this.width/2+this.soul_size)*(this.relative=="minus"?1:-1)*-m(-s)+h*y(-s);t.x=d+this.dx,t.y=o+this.dy}}else l>0?this.relative="plus":this.relative="minus"}draw(){e.drawRect(this.dx,this.dy,this.len,this.width,"white",this.dd,"center++")}}class c{constructor(s,n,a,h=4){this.dx=s,this.dy=n,this.dd=a,this.width=h}judge(){const s=this.dd,n=t.x-this.dx,a=t.y-this.dy,h=n*m(s)+a*-y(s);if(a*m(s)+n*y(s)>-this.width){const d=h*m(-s)+this.width*y(-s),o=this.width*-m(-s)+h*y(-s);t.x=d+this.dx,t.y=o+this.dy}}draw(){const s=this.dx+320*y(this.dd),n=this.dy+320*m(this.dd);e.drawRect(s,n,640,640,"#ffffff88",this.dd,"center++")}}const p={center_x:320,center_y:240,dire:0,width:100,height:100,thickness:6,walls:[],draw(){this.walls.forEach(i=>{const s=i.dx+640*y(i.dd),n=i.dy+640*m(i.dd);e.drawRect(s,n,1280,1280,"#ffffff",i.dd,"center++")}),this.walls.forEach(i=>{const s=i.dx+640*y(i.dd),n=i.dy+640*m(i.dd);e.drawRect(s,n,1280-i.width*2,1280-i.width*2,"#000000",i.dd,"center++")})},judge(){this.walls.forEach(i=>{i.judge()})},update(){{const i=this.dire,s=this.center_x,n=this.center_y,a=this.walls[0];a.dd=i,a.dx=s+this.height/2*y(i),a.dy=n+this.height/2*m(i)}{const i=this.dire+90,s=this.center_x,n=this.center_y,a=this.walls[1];a.dd=i,a.dx=s+this.height/2*y(i),a.dy=n+this.height/2*m(i)}{const i=this.dire+180,s=this.center_x,n=this.center_y,a=this.walls[2];a.dd=i,a.dx=s+this.height/2*y(i),a.dy=n+this.height/2*m(i)}{const i=this.dire+270,s=this.center_x,n=this.center_y,a=this.walls[3];a.dd=i,a.dx=s+this.height/2*y(i),a.dy=n+this.height/2*m(i)}},init(){this.walls.push(new c(0,0,0,this.thickness)),this.walls.push(new c(0,0,90,this.thickness)),this.walls.push(new c(0,0,180,this.thickness)),this.walls.push(new c(0,0,270,this.thickness))}};return p.init(),{Wall:g,box:p}},Ye=async()=>{const e=await F(T);let t="battle";const g={lv:1,hp:20,hp_max:20,soul:new e.Sprite(320,240,0,80,"soul",!0),damage(d){this.hp-=d,e.aLib.play_ctx("damage",2),this.hp<=0&&(t="game_over")}},c=W(e.cLib,e.aLib,e.Sprite,g),p=Oe(e.cLib,e.inputKeys),s=Qe(e.cLib,g.soul).box,n=ts(e.cLib,p.Plane,g);let a=new p.Plane("test","Hello, world!",60,180,0,400,"white",0,0,5,"en"),h=0;new c.normal(300,200,90,20,250,0,0,2,0,1/0),await e.while(()=>t==="battle",()=>{h++,e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.inputKeys.up&&(g.soul.y+=3.5),e.inputKeys.down&&(g.soul.y-=3.5),e.inputKeys.right&&(g.soul.x+=3.5),e.inputKeys.left&&(g.soul.x-=3.5),s.judge(),s.update(),c.process(),s.draw(),p.process(),a.write(),n(),g.soul.stamp(),e.cLib.stamp("back",320,240,0,100,.2)}),h=0;let l=[];await e.while(()=>t==="game_over",()=>{if(e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),h==0)e.aLib.play_ctx("heartbreak_1",2);else if(h<60)e.cLib.stamp("death_0",g.soul.x,g.soul.y,0,80);else if(h==60){e.aLib.play_ctx("heartbreak_2",2);for(let d=0;d<4;d++){let o=Math.random()*12-6,r=Math.random()*8+4;l.push(new e.Sprite(g.soul.x,g.soul.y,Math.random()*360,80,`death_${d+1}`,!0,_=>{_.x+=o,_.y+=r,_.d+=o,r-=.333,_.stamp()}))}}else 60<h&&h<180?l.forEach(d=>d.act()):h==180&&(t="waiting");h++})},ts=(e,t,g)=>()=>{const c=new t("_","chara",32,75,0,300,"white",0,0,0,"status");c.write(),c.delete();const p=new t("_","lV",134,75,0,300,"white",0,0,0,"status");p.write(),p.delete();const i=new t("_",`${("00"+g.lv).slice(-2)}`,173,75,0,300,"white",0,0,0,"status");i.write(),i.delete();const s=new t("_",`${("00"+g.hp).slice(-2)}`,g.hp_max*1.2+306,77,0,300,"white",0,0,0,"status");s.write(),s.delete();const n=new t("_","/",g.hp_max*1.2+345,77,0,300,"white",0,0,0,"status");n.write(),n.delete();const a=new t("_",`${("00"+g.hp_max).slice(-2)}`,g.hp_max*1.2+369,77,0,300,"white",0,0,0,"status");a.write(),a.delete(),e.drawRect(256,59,g.hp_max*1.2,21,"red",0,"start"),e.drawRect(256,59,g.hp*1.2,21,"yellow",0,"start"),e.stamp("hp_white",224,74,0,100,1,"start"),e.stamp("kr_white",g.hp_max*1.2+267,74,0,100,1,"start"),console.log(g.hp_max*1.2+267,377)};window.onload=Ye;
