const P=h=>{const t=(s,e)=>{s()||(e(),h.tick(),requestAnimationFrame(()=>t(s,e)))},c=(s,e,i=0)=>{i<s&&(e(i),h.tick(),requestAnimationFrame(()=>c(s,e,i+1)))},r=s=>{s(),h.tick(),requestAnimationFrame(()=>r(s))};return{frameWhile:t,frameFor:c,frameLoop:r}},z=[{type:"image",name:"soul",src:"./assets/images/soul.png"},{type:"image",name:"soul_blue",src:"./assets/images/soul_blue.png"},{type:"image",name:"commands",src:"./assets/images/commands.png"},{type:"image",name:"back",src:"./assets/images/back.png"},{type:"image",name:"sans",src:"./assets/images/sans.png"},{type:"image",name:"hp_kr_purple",src:"./assets/images/hp_kr_purple.png"},{type:"image",name:"determination_white",src:"./assets/images/font/determination_white.png"},{type:"image",name:"determination_red",src:"./assets/images/font/determination_red.png"},{type:"image",name:"determination_orange",src:"./assets/images/font/determination_orange.png"},{type:"image",name:"determination_blue",src:"./assets/images/font/determination_blue.png"},{type:"image",name:"determination_yellow",src:"./assets/images/font/determination_yellow.png"},{type:"image",name:"status_white",src:"./assets/images/font/status_white.png"},{type:"image",name:"status_red",src:"./assets/images/font/status_red.png"},{type:"image",name:"status_orange",src:"./assets/images/font/status_orange.png"},{type:"image",name:"status_blue",src:"./assets/images/font/status_blue.png"},{type:"image",name:"status_yellow",src:"./assets/images/font/status_yellow.png"},{type:"image",name:"status_purple",src:"./assets/images/font/status_purple.png"},{type:"image",name:"hp_kr_white",src:"./assets/images/hp_kr_white.png"},{type:"image",name:"hp_kr_red",src:"./assets/images/hp_kr_red.png"},{type:"image",name:"hp_kr_purple",src:"./assets/images/hp_kr_purple.png"},{type:"image",name:"bone_head_white",src:"./assets/images/bone_head_white.png"},{type:"image",name:"bananahexagon",src:"./assets/images/normal_icon.png"},{type:"audio",name:"damage",src:"./assets/audios/damage.mp3"}],E=async()=>{const h={},t={},c={},r=z,s=[];return console.log(r),r.forEach(e=>s.push(new Promise(i=>{switch(e.type){case"image":{const p=new Image;p.src=e.src,p.onload=()=>{h[e.name]=p,i()}}break;case"audio":{const p=new Audio(e.src);p.autoplay=!1,p.muted=!0,console.log(p),p.addEventListener("loadeddata",()=>{p.muted=!1,t[e.name]=[p,0],i()})}break;case"font":(async()=>{const n=await(await(await fetch(e.src)).text()).match(/url\(.+?\)/g);if(!n)throw new Error("フォントが見つかりませんでした");const g=[];n.forEach(o=>{g.push((async()=>{const d=new FontFace(e.name,o);await d.load(),c[e.name]=d,await document.fonts.add(d)})())}),Promise.all(g)})().then(i);break}}))),await Promise.all(s),{Images:h,Audios:t,Fonts:c}},y=h=>Math.sin(h/360*Math.PI*2),m=h=>Math.cos(h/360*Math.PI*2),A=(h,t,c,r,s,e)=>{const i=(g,o,d,u=0,_=100,w=1,l="center",f,$=!1)=>{if($){const b=c[g],[x,M,v,q]=f===void 0?[0,0,b.width,b.height]:[f.left,f.top,f.width,f.height];switch(t.globalAlpha=w,l){case"center":t.save(),t.translate(o*s.display_quality,-d*s.display_quality+h.height),t.rotate(u*Math.PI/180),t.drawImage(b,x,M,v,q,-v*_/200*s.display_quality,-q*_/200*s.display_quality,v*_/100*s.display_quality,q*_/100*s.display_quality),t.restore();break;case"start":t.save(),t.translate(o*s.display_quality,-d*s.display_quality+h.height),t.rotate(u*Math.PI/180),t.drawImage(b,x,M,v,q,0,0,v*_/100*s.display_quality,q*_/100*s.display_quality),t.restore()}}else{const b=(m(e.d)*o-y(e.d)*d+e.x)*e.size/100,x=(y(e.d)*o+m(e.d)*d+e.y)*e.size/100,M=u+e.d;i(g,b,x,M,_*e.size/100,w,l,f,!0)}};return{stamp:i,drawRect:(g,o,d,u,_,w=0,l="center")=>{switch(t.globalAlpha=1,t.save(),l){case"center++":t.translate(g*s.display_quality,-o*s.display_quality+h.height),t.rotate(w*Math.PI/180),t.beginPath(),t.rect(-d/2*s.display_quality,-u/2*s.display_quality,d*s.display_quality,u*s.display_quality);break;case"center":t.translate((g-d/2)*s.display_quality,-(o-u/2)*s.display_quality+h.height),t.rotate(w*Math.PI/180),t.beginPath(),t.rect(0,0,d*s.display_quality,-u*s.display_quality);break;case"start":default:t.translate(g*s.display_quality,-o*s.display_quality+h.height),t.rotate(w*Math.PI/180),t.beginPath(),t.rect(0,0,d*s.display_quality,-u*s.display_quality);break}t.fillStyle=_,t.fill(),t.restore()},drawLine:(g,o,d,u,_,w,l=0)=>{switch(t.globalAlpha=1,t.beginPath(),l){case 0:t.moveTo((g-u*Math.sin(d)/2)*s.display_quality,-(o+u*Math.cos(d)/2)*s.display_quality+h.height),t.lineTo((g+u*Math.sin(d)/2)*s.display_quality,-(o-u*Math.cos(d)/2)*s.display_quality+h.height);break;case 1:t.moveTo(g*s.display_quality,-o*s.display_quality+h.height),t.lineTo((g+u*Math.sin(d))*s.display_quality,-(o-u*Math.cos(d))*s.display_quality+h.height);break}t.strokeStyle=w,t.lineWidth=_*s.display_quality,t.stroke()},drawText:(g,o,d,u,_,w="serif",l="left")=>{t.globalAlpha=1;const[f,$]=[o*s.display_quality,-d*s.display_quality+h.height];t.font=`${u*s.display_quality}px ${w}`,t.textAlign=l,t.fillStyle=_,t.fillText(g,f,$)}}},I=h=>{class t{constructor(r,s,e=0,i=100,p="",a=!1){this.x=r,this.y=s,this.d=e,this.size=i,this.costume=p,this.visible=a}stamp(){this.visible&&h.stamp(this.costume,this.x,this.y,this.d,this.size)}move(r){this.x+=y(this.d)*r,this.y+=m(this.d)*r}}return t},R=(h,t,c)=>({raw_to_stage:(s,e,i=0)=>{const p=h.getBoundingClientRect(),a=((s-p.left)/c.size*100-c.x)*t.stage_width/t.display_width,n=(t.display_height-((e-p.top)/c.size*100-c.y))*t.stage_height/t.display_height,g=i+c.d;return{x:a,y:n,d:g}}}),F=h=>({play:(s,e,i=0)=>{h[s][1]==0&&(h[s][0].play(),e!==void 0&&(h[s][0].currentTime=e),h[s][1]=i)},get:s=>h[s][0],tick:()=>{for(const s in h){const e=h[s];0<e[1]&&(e[1]-=1)}}}),D=async h=>{const t=document.getElementById(h.canvas_name);t.height=h.stage_height*h.display_quality,t.width=h.stage_width*h.display_quality;const c=t.getContext("2d"),{Images:r,Audios:s,Fonts:e}=await E(),i={up:!1,down:!1,left:!1,right:!1,z:!1,x:!1,c:!1,d:!1},p={x:0,y:0,clicking:!1,is_in_rect(l,f,$,b,x="center"){switch(x){case"center":return l-$/2<this.x&&this.x<l+$/2&&f-b/2<this.y&&this.y<f+b/2;case"start":default:return l<this.x&&this.x<l+$&&f<this.y&&this.y<f+b}}},a={canvas:{size:100,x:0,y:0,d:0}},n=A(t,c,r,e,h,a.canvas),g=F(s),o=I(n);c.imageSmoothingEnabled=!1;const d=R(t,h,a.canvas);window.addEventListener("keydown",l=>{switch(l.key){case"ArrowUp":i.up=!0;break;case"ArrowDown":i.down=!0;break;case"ArrowLeft":i.left=!0;break;case"ArrowRight":i.right=!0;break;case"z":case"Z":i.z=!0;break;case"x":case"X":i.x=!0;break;case"c":case"C":i.c=!0;break;case"d":case"D":i.d=!0;break}}),window.addEventListener("keyup",l=>{switch(l.key){case"ArrowUp":i.up=!1;break;case"ArrowDown":i.down=!1;break;case"ArrowLeft":i.left=!1;break;case"ArrowRight":i.right=!1;break;case"z":case"Z":i.z=!1;break;case"x":case"X":i.x=!1;break;case"c":case"C":i.c=!1;break;case"d":case"D":i.d=!1;break}}),t.addEventListener("mousedown",l=>{p.clicking=!0;const f=d.raw_to_stage(l.x,l.y);p.x=f.x,p.y=f.y}),t.addEventListener("mousemove",l=>{const f=d.raw_to_stage(l.x,l.y);p.x=f.x,p.y=f.y}),t.addEventListener("mouseup",l=>{p.clicking=!1;const f=d.raw_to_stage(l.x,l.y);p.x=f.x,p.y=f.y});const{frameWhile:u,frameFor:_,frameLoop:w}=P(g);return{canvas:t,ctx:c,Images:r,Audios:s,Fonts:e,inputKeys:i,inputMouse:p,props:a,cLib:n,aLib:g,Sprite:o,for:_,while:u,loop:w}},L=2,S=640,G=480,T=800,j=400,B="canvas",C={display_quality:L,stage_width:S,stage_height:G,display_width:T,display_height:j,canvas_name:B},W=(h,t,c)=>{let r={};const s=class k extends t{constructor(a,n,g,o,d,u,_,w,l,f){super(a,n,g,o,void 0,!0),this.start_x=a,this.start_y=n,this.start_d=g,this.move_x=u,this.move_y=_,this.move_d=w,this.start_len=d,this.move_len=l,this.len=d,this.age=0,this.id=k.current_id,this.width=o,r[this.id]=this,k.current_id++}move_self(){this.age++,this.x=this.start_x+k.get_move(this.move_x,this.age),this.y=this.start_y+k.get_move(this.move_y,this.age),this.d=this.start_d+k.get_move(this.move_d,this.age),this.len=this.start_len+k.get_move(this.move_len,this.age)}draw(){m(this.d),h.stamp("bone_head_white",this.x+m(this.d)*this.width*8/6,this.y-y(this.d)*this.width*8/6,this.d+180,this.width*100/6,1,"start"),h.drawRect(this.x+y(this.d)*this.width*6/6,this.y+m(this.d)*this.width*6/6,this.width,this.len+this.width*2/6,"white",this.d,"start"),h.stamp("bone_head_white",this.x+y(this.d)*(this.len+this.width*14/6)-m(this.d)*this.width*2/6,this.y+m(this.d)*(this.len+this.width*14/6)+y(this.d)*this.width*2/6,this.d,this.width*100/6,1,"start")}judge(){h.drawRect(this.x,this.y,this.width,this.len+this.width*14/6,"red",this.d,"start"),h.drawRect(this.x+y(this.d)*(this.len/2+this.width*7/6)+m(this.d)*this.width*3/6,this.y+m(this.d)*(this.len/2+this.width*7/6)-y(this.d)*this.width*3/6,this.width,this.len+this.width*14/6,"blue",this.d,"center++");{const a=c.soul.x-this.x,n=c.soul.y-this.y,g=a*m(this.d)+n*-y(this.d),o=n*m(this.d)+a*y(this.d);this.len+this.width*14/6>o&&o>0&&this.width>g&&g>0&&(c.hp-=1)}}static process(){for(const a in r){const n=r[a];n.move_self(),n.draw(),n.judge()}}static get_move(a,n){if(typeof a=="number")return a*n;switch(a.type){case"sin":case"cos":return y(a.cycle*n)*a.amp;case"custom":return a.fn(n)}}};s.current_id=0;let e=s;return{boneDict:r,normal:e,process:()=>{e.process()}}},K={height_basic:15,width_basic:2,name:"determination"},U={left:10,up:34,width:6,height:9,gap:0},X={left:20,up:34,width:6,height:9,gap:0},Z={left:30,up:34,width:6,height:9,gap:0},H={left:40,up:34,width:6,height:9,gap:0},V={left:50,up:34,width:6,height:9,gap:0},J={left:60,up:34,width:6,height:9,gap:0},N={left:70,up:34,width:6,height:9,gap:0},O={left:80,up:34,width:6,height:9,gap:0},Q={left:90,up:34,width:6,height:9,gap:0},Y={left:100,up:34,width:6,height:9,gap:0},tt={left:110,up:34,width:6,height:9,gap:0},et={left:120,up:34,width:6,height:9,gap:0},st={left:130,up:34,width:7,height:9,gap:0},it={left:140,up:34,width:6,height:9,gap:0},ht={left:150,up:34,width:6,height:9,gap:0},at={left:0,up:50,width:6,height:9,gap:0},nt={left:10,up:50,width:6,height:9,gap:0},pt={left:20,up:50,width:6,height:9,gap:0},lt={left:30,up:50,width:6,height:9,gap:0},dt={left:40,up:50,width:6,height:9,gap:0},gt={left:50,up:50,width:6,height:9,gap:0},ot={left:60,up:50,width:6,height:9,gap:0},rt={left:70,up:50,width:7,height:9,gap:0},ct={left:80,up:50,width:6,height:9,gap:0},ut={left:90,up:50,width:6,height:9,gap:0},wt={left:100,up:50,width:6,height:9,gap:0},ft={left:10,up:68,width:6,height:7,gap:2},_t={left:20,up:66,width:6,height:9,gap:0},yt={left:30,up:68,width:6,height:7,gap:2},mt={left:40,up:66,width:6,height:9,gap:0},bt={left:50,up:68,width:6,height:7,gap:2},$t={left:60,up:66,width:6,height:9,gap:0},xt={left:70,up:68,width:6,height:10,gap:5},kt={left:80,up:66,width:6,height:9,gap:0},vt={left:90,up:65,width:6,height:10,gap:-1},qt={left:100,up:65,width:6,height:13,gap:2},Mt={left:110,up:66,width:6,height:9,gap:0},Pt={left:120,up:66,width:6,height:9,gap:0},zt={left:130,up:68,width:7,height:7,gap:2},Et={left:140,up:68,width:6,height:7,gap:2},At={left:150,up:68,width:6,height:7,gap:2},It={left:0,up:84,width:6,height:10,gap:5},Rt={left:10,up:84,width:6,height:10,gap:5},Ft={left:20,up:84,width:6,height:7,gap:2},Dt={left:30,up:84,width:6,height:7,gap:2},Lt={left:40,up:82,width:6,height:9,gap:0},St={left:50,up:84,width:6,height:7,gap:2},Gt={left:60,up:84,width:6,height:7,gap:2},Tt={left:70,up:84,width:7,height:7,gap:2},jt={left:80,up:84,width:6,height:7,gap:2},Bt={left:90,up:84,width:6,height:10,gap:5},Ct={left:100,up:84,width:6,height:7,gap:2},Wt={left:0,up:0,width:1,height:1,gap:0},Kt={left:150,up:82,width:6,height:9,gap:0},Ut={left:40,up:0,width:6,height:13,gap:0},Xt={left:150,up:61,width:4,height:1,gap:14},Zt={0:{left:0,up:18,width:6,height:9,gap:0},1:{left:10,up:18,width:6,height:9,gap:0},2:{left:20,up:18,width:6,height:9,gap:0},3:{left:30,up:18,width:6,height:9,gap:0},4:{left:40,up:18,width:6,height:9,gap:0},5:{left:50,up:18,width:6,height:9,gap:0},6:{left:60,up:18,width:6,height:9,gap:0},7:{left:70,up:18,width:6,height:9,gap:0},8:{left:80,up:18,width:6,height:9,gap:0},9:{left:90,up:18,width:6,height:9,gap:0},props:K,A:U,B:X,C:Z,D:H,E:V,F:J,G:N,H:O,I:Q,J:Y,K:tt,L:et,M:st,N:it,O:ht,P:at,Q:nt,R:pt,S:lt,T:dt,U:gt,V:ot,W:rt,X:ct,Y:ut,Z:wt,a:ft,b:_t,c:yt,d:mt,e:bt,f:$t,g:xt,h:kt,i:vt,j:qt,k:Mt,l:Pt,m:zt,n:Et,o:At,p:It,q:Rt,r:Ft,s:Dt,t:Lt,u:St,v:Gt,w:Tt,x:jt,y:Bt,z:Ct,space:Wt,irregular:Kt,"!":{left:10,up:1,width:4,height:10,gap:-1},'"':{left:20,up:2,width:5,height:4,gap:-5},"#":{left:30,up:2,width:7,height:9,gap:0},$:Ut,"%":{left:50,up:2,width:7,height:9,gap:0},"&":{left:60,up:2,width:7,height:9,gap:0},"'":{left:70,up:2,width:2,height:4,gap:-5},"(":{left:80,up:2,width:4,height:9,gap:0},")":{left:90,up:2,width:4,height:9,gap:0},"*":{left:100,up:4,width:8,height:5,gap:0},"+":{left:110,up:4,width:6,height:5,gap:0},",":{left:120,up:9,width:2,height:4,gap:7},"-":{left:130,up:6,width:5,height:1,gap:0},".":{left:140,up:9,width:2,height:2,gap:7},"/":{left:150,up:2,width:6,height:10,gap:1},":":{left:100,up:20,width:2,height:7,gap:2},";":{left:110,up:20,width:2,height:9,gap:4},"<":{left:120,up:18,width:5,height:9,gap:0},"=":{left:130,up:21,width:5,height:3,gap:0},">":{left:140,up:18,width:5,height:9,gap:0},"?":{left:150,up:18,width:6,height:9,gap:0},"@":{left:0,up:34,width:6,height:9,gap:0},"[":{left:110,up:50,width:4,height:9,gap:0},"\\":{left:120,up:50,width:6,height:10,gap:1},"]":{left:130,up:50,width:4,height:9,gap:0},"^":{left:140,up:49,width:6,height:4,gap:-5},_:Xt,"`":{left:10,up:68,width:3,height:2,gap:2},"{":{left:110,up:82,width:5,height:9,gap:0},"|":{left:120,up:82,width:2,height:9,gap:0},"}":{left:130,up:82,width:5,height:9,gap:0},"~":{left:140,up:85,width:7,height:2,gap:-1}},Ht={height_basic:6,width_basic:1,name:"status"},Vt={left:6,up:14,width:4,height:5,gap:0},Jt={left:12,up:14,width:4,height:5,gap:0},Nt={left:18,up:14,width:4,height:5,gap:0},Ot={left:24,up:14,width:4,height:5,gap:0},Qt={left:30,up:14,width:4,height:5,gap:0},Yt={left:36,up:14,width:4,height:5,gap:0},te={left:42,up:14,width:4,height:5,gap:0},ee={left:48,up:14,width:4,height:5,gap:0},se={left:54,up:14,width:4,height:5,gap:0},ie={left:60,up:14,width:4,height:5,gap:0},he={left:66,up:14,width:4,height:5,gap:0},ae={left:72,up:14,width:4,height:5,gap:0},ne={left:78,up:14,width:5,height:5,gap:0},pe={left:84,up:14,width:4,height:5,gap:0},le={left:90,up:14,width:4,height:5,gap:0},de={left:0,up:21,width:4,height:5,gap:0},ge={left:6,up:21,width:4,height:5,gap:0},oe={left:12,up:21,width:4,height:5,gap:0},re={left:18,up:21,width:4,height:5,gap:0},ce={left:24,up:21,width:4,height:5,gap:0},ue={left:30,up:21,width:4,height:5,gap:0},we={left:36,up:21,width:4,height:5,gap:0},fe={left:42,up:21,width:5,height:5,gap:0},_e={left:48,up:21,width:4,height:5,gap:0},ye={left:54,up:21,width:4,height:5,gap:0},me={left:60,up:21,width:4,height:5,gap:0},be={left:6,up:28,width:4,height:5,gap:0},$e={left:12,up:28,width:4,height:5,gap:0},xe={left:18,up:28,width:4,height:5,gap:0},ke={left:24,up:28,width:4,height:5,gap:0},ve={left:30,up:28,width:4,height:5,gap:0},qe={left:36,up:28,width:4,height:5,gap:0},Me={left:42,up:28,width:4,height:5,gap:0},Pe={left:48,up:28,width:4,height:5,gap:0},ze={left:54,up:28,width:4,height:5,gap:0},Ee={left:60,up:28,width:4,height:5,gap:0},Ae={left:66,up:28,width:4,height:5,gap:0},Ie={left:72,up:28,width:4,height:5,gap:0},Re={left:78,up:28,width:5,height:5,gap:0},Fe={left:84,up:28,width:4,height:5,gap:0},De={left:90,up:28,width:4,height:5,gap:0},Le={left:0,up:35,width:4,height:5,gap:0},Se={left:6,up:35,width:4,height:5,gap:0},Ge={left:12,up:35,width:4,height:5,gap:0},Te={left:18,up:35,width:4,height:5,gap:0},je={left:24,up:35,width:4,height:5,gap:0},Be={left:30,up:35,width:4,height:5,gap:0},Ce={left:36,up:35,width:4,height:5,gap:0},We={left:42,up:35,width:5,height:5,gap:0},Ke={left:48,up:35,width:4,height:5,gap:0},Ue={left:54,up:35,width:4,height:5,gap:0},Xe={left:60,up:35,width:4,height:5,gap:0},Ze={left:0,up:0,width:4,height:1,gap:0},He={left:90,up:35,width:4,height:5,gap:0},Ve={left:24,up:0,width:5,height:5,gap:0},Je={left:90,up:25,width:4,height:1,gap:4},Ne={0:{left:0,up:7,width:4,height:5,gap:0},1:{left:6,up:7,width:4,height:5,gap:0},2:{left:12,up:7,width:4,height:5,gap:0},3:{left:18,up:7,width:4,height:5,gap:0},4:{left:24,up:7,width:4,height:5,gap:0},5:{left:30,up:7,width:4,height:5,gap:0},6:{left:36,up:7,width:4,height:5,gap:0},7:{left:42,up:7,width:4,height:5,gap:0},8:{left:48,up:7,width:4,height:5,gap:0},9:{left:54,up:7,width:4,height:5,gap:0},props:Ht,A:Vt,B:Jt,C:Nt,D:Ot,E:Qt,F:Yt,G:te,H:ee,I:se,J:ie,K:he,L:ae,M:ne,N:pe,O:le,P:de,Q:ge,R:oe,S:re,T:ce,U:ue,V:we,W:fe,X:_e,Y:ye,Z:me,a:be,b:$e,c:xe,d:ke,e:ve,f:qe,g:Me,h:Pe,i:ze,j:Ee,k:Ae,l:Ie,m:Re,n:Fe,o:De,p:Le,q:Se,r:Ge,s:Te,t:je,u:Be,v:Ce,w:We,x:Ke,y:Ue,z:Xe,space:Ze,irregular:He,"!":{left:6,up:0,width:4,height:5,gap:0},'"':{left:12,up:0,width:3,height:2,gap:0},"#":{left:18,up:0,width:5,height:5,gap:0},$:Ve,"%":{left:30,up:1,width:4,height:4,gap:1},"&":{left:36,up:0,width:5,height:5,gap:0},"'":{left:42,up:0,width:1,height:2,gap:-3},"(":{left:48,up:0,width:3,height:5,gap:0},")":{left:54,up:0,width:3,height:5,gap:0},"*":{left:60,up:0,width:5,height:5,gap:0},"+":{left:66,up:0,width:5,height:5,gap:0},",":{left:72,up:3,width:1,height:2,gap:3},"-":{left:78,up:2,width:5,height:1,gap:0},".":{left:84,up:4,width:1,height:1,gap:4},"/":{left:90,up:1,width:4,height:4,gap:1},":":{left:60,up:8,width:1,height:3,gap:0},";":{left:66,up:8,width:1,height:4,gap:1},"<":{left:72,up:7,width:3,height:5,gap:0},"=":{left:78,up:8,width:5,height:3,gap:0},">":{left:84,up:7,width:3,height:5,gap:0},"?":{left:90,up:7,width:4,height:5,gap:0},"@":{left:0,up:14,width:4,height:5,gap:0},"[":{left:66,up:21,width:4,height:5,gap:0},"\\":{left:72,up:22,width:4,height:4,gap:1},"]":{left:78,up:21,width:4,height:5,gap:0},"^":{left:84,up:21,width:5,height:3,gap:-1},_:Je,"`":{left:0,up:27,width:1,height:2,gap:-5},"{":{left:66,up:35,width:3,height:5,gap:0},"|":{left:72,up:35,width:1,height:5,gap:0},"}":{left:78,up:35,width:3,height:5,gap:0},"~":{left:84,up:35,width:4,height:2,gap:-3}},Oe=(h,t)=>{const c={en:Zt,status:Ne};let r={};class s{constructor(n){this.name=n}delete(){delete r[this.name]}}class e extends s{constructor(n,g,o,d,u,_,w){super(n),this._={all_str:w.reduce((l,f)=>l+f.str,""),now:[{str:"",color:w[0].color,spacing_x:w[0].spacing_x,spacing_y:w[0].spacing_y}],len_allow:0,count:0,current_char:0,current_char_true:0},this.x=g,this.y=o,this.direction=d,this.size=u,this.data=w,this.font=(l=>{switch(l){case"status":return c.status;default:return c.en}})(_),r[n]=this,this.process()}write(){const n=this.size,g=this.direction*Math.PI/180,o=this._.now.reduce((l,f)=>l+f.str.length,0);let d=0,u=0,_=0;const w=l=>l in this.font?this.font[l]:this.font.space;return this._.now.forEach(l=>{l.str.split("").forEach($=>{const b=w($);$==`
`?(d=0,u+=this.font.props.height_basic+l.spacing_y):(h.stamp(this.font.props.name+"_"+l.color,this.x+(Math.cos(g)*d-Math.sin(g)*(u+b.gap/2))*n/100,this.y+(Math.sin(g)*d+Math.cos(g)*(u+b.gap/2))*n/100,this.direction,n,1,"start",{left:b.left,top:b.up,width:b.width,height:b.height}),_+1<o&&(d+=b.width+this.font.props.width_basic+l.spacing_x)),_++})}),this}process(){const n=this.data.reduce((g,o)=>g+o.str.length,0);if(this._.len_allow==n&&t.z){delete r[this.name];return}else t.x?(this._.len_allow=n,this._.current_char=n):this._.len_allow<n&&(this._.len_allow+=1/this.data[this._.count].speed,this._.current_char+=1/this.data[this._.count].speed);for(;this._.current_char_true<Math.min(this._.len_allow,n);)for(this._.now[this._.count].str+=this.data[this._.count].str[this._.now[this._.count].str.length],this._.current_char_true++;this.data[this._.count].str.length<=this._.now[this._.count].str.length&&this._.count+1<this.data.length;)this._.count++,this._.now.push({str:"",color:this.data[this._.count].color===void 0?"white":this.data[this._.count].color,spacing_x:this.data[this._.count].spacing_x,spacing_y:this.data[this._.count].spacing_y}),this._.current_char-=this.data[this._.count].str.length}}class i extends s{constructor(n,g,o,d,u,_,w,l,f,$,b){super(n),this.str_now="",this.len_now=0,this.str=g,this.x=o,this.y=d,this.direction=u,this.size=_,this.color=w,this.spacing_x=l,this.spacing_y=f,this.speed=$,this.font=(x=>{switch(x){case"status":return c.status;default:return c.en}})(b),this.len_allow=0,r[n]=this,this.process()}write(){const n=this.str_now,g=this.size,o=this.direction*Math.PI/180;let d,u;[d,u]=[0,0];const _=w=>w in this.font?this.font[w]:this.font.space;for(let w=0;w<n.length;w++){const l=_(n[w]);n[w]==`
`?(d=0,u+=this.font.props.height_basic+this.spacing_y):(h.stamp(this.font.props.name+"_"+(this.color?this.color:"white"),this.x+(Math.cos(o)*d-Math.sin(o)*(u-l.gap))*g/100,this.y+(Math.sin(o)*d+Math.cos(o)*(u-l.gap))*g/100,this.direction,g,1,"start",{left:l.left,top:l.up,width:l.width,height:l.height}),w+1<n.length&&(d+=l.width+this.font.props.width_basic+this.spacing_x))}return this}process(){if(this.len_allow==this.str.length&&t.z){delete r[this.name];return}else t.x?this.len_allow=this.str.length:this.len_allow<this.str.length&&(this.len_allow+=1/this.speed);for(;this.str_now.length<Math.min(this.len_allow,this.str.length);)this.str_now+=this.str[this.str_now.length]}}return{Super:e,Plane:i,process:()=>{for(const a in r)r[a].process()},dict:r}},Qe=(h,t)=>{class c{constructor(i,p,a,n,g,o,d=4){this.dx=i,this.dy=p,this.dd=a,this.len=n,this.align=g,this.width=d,this.soul_size=6,this.relative=o||(()=>{const u=this.dd,_=t.x-this.dx;return(t.y-this.dy)*m(u)+_*y(u)>0?"plus":"minus"})()}judge(){const i=this.dd,p=t.x-this.dx,a=t.y-this.dy,n=p*m(i)+a*-y(i),g=a*m(i)+p*y(i);if(this.len/2>n&&n>-this.len/2){if(this.relative=="minus"&&g>-(this.width/2+this.soul_size)||this.relative=="plus"&&this.width/2+this.soul_size>g){const o=n*m(-i)+(this.width/2+this.soul_size)*(this.relative=="minus"?1:-1)*y(-i),d=(this.width/2+this.soul_size)*(this.relative=="minus"?1:-1)*-m(-i)+n*y(-i);t.x=o+this.dx,t.y=d+this.dy}}else g>0?this.relative="plus":this.relative="minus"}draw(){h.drawRect(this.dx,this.dy,this.len,this.width,"white",this.dd,"center++")}}class r{constructor(i,p,a,n=4){this.dx=i,this.dy=p,this.dd=a,this.width=n}judge(){const i=this.dd,p=t.x-this.dx,a=t.y-this.dy,n=p*m(i)+a*-y(i);if(a*m(i)+p*y(i)>-this.width){const o=n*m(-i)+this.width*y(-i),d=this.width*-m(-i)+n*y(-i);t.x=o+this.dx,t.y=d+this.dy}}draw(){const i=this.dx+320*y(this.dd),p=this.dy+320*m(this.dd);h.drawRect(i,p,640,640,"#ffffff88",this.dd,"center++")}}const s={center_x:320,center_y:240,dire:0,width:100,height:100,thickness:6,walls:[],draw(){this.walls.forEach(e=>{const i=e.dx+640*y(e.dd),p=e.dy+640*m(e.dd);h.drawRect(i,p,1280,1280,"#ffffff",e.dd,"center++")}),this.walls.forEach(e=>{const i=e.dx+640*y(e.dd),p=e.dy+640*m(e.dd);h.drawRect(i,p,1280-e.width*2,1280-e.width*2,"#000000",e.dd,"center++")})},judge(){this.walls.forEach(e=>{e.judge()})},update(){{const e=this.dire,i=this.center_x,p=this.center_y,a=this.walls[0];a.dd=e,a.dx=i+this.height/2*y(e),a.dy=p+this.height/2*m(e)}{const e=this.dire+90,i=this.center_x,p=this.center_y,a=this.walls[1];a.dd=e,a.dx=i+this.height/2*y(e),a.dy=p+this.height/2*m(e)}{const e=this.dire+180,i=this.center_x,p=this.center_y,a=this.walls[2];a.dd=e,a.dx=i+this.height/2*y(e),a.dy=p+this.height/2*m(e)}{const e=this.dire+270,i=this.center_x,p=this.center_y,a=this.walls[3];a.dd=e,a.dx=i+this.height/2*y(e),a.dy=p+this.height/2*m(e)}},init(){this.walls.push(new r(0,0,0,this.thickness)),this.walls.push(new r(0,0,90,this.thickness)),this.walls.push(new r(0,0,180,this.thickness)),this.walls.push(new r(0,0,270,this.thickness))}};return s.init(),{Wall:c,box:s}},Ye=async()=>{const h=await D(C),t={lv:19,hp:92,hp_max:92,soul:new h.Sprite(320,240,0,80,"soul",!0)},c=W(h.cLib,h.Sprite,t),r=Oe(h.cLib,h.inputKeys);Qe(h.cLib,t.soul),new c.normal(260,180,60,12,200,0,0,0,0,0);const s=ts(h.cLib,r.Plane,t);let e=new r.Plane("test","Hello, world!",60,180,0,400,"white",0,0,5,"en");h.loop(()=>{h.ctx.clearRect(0,0,h.canvas.width,h.canvas.height),h.inputKeys.up&&(t.soul.y+=3.5),h.inputKeys.down&&(t.soul.y-=3.5),h.inputKeys.right&&(t.soul.x+=3.5),h.inputKeys.left&&(t.soul.x-=3.5),c.process(),r.process(),e.write(),s(),t.soul.stamp()})},ts=(h,t,c)=>()=>{const r=new t("_","chara",32,75,0,300,"white",0,0,0,"status");r.write(),r.delete();const s=new t("_","lV",134,75,0,300,"white",0,0,0,"status");s.write(),s.delete();const e=new t("_",`${c.lv}`,173,75,0,300,"white",0,0,0,"status");e.write(),e.delete();const i=new t("_",`${c.hp}`,416,77,0,300,"white",0,0,0,"status");i.write(),i.delete();const p=new t("_","/",455,77,0,300,"white",0,0,0,"status");p.write(),p.delete();const a=new t("_",`${c.hp_max}`,479,77,0,300,"white",0,0,0,"status");a.write(),a.delete(),h.drawRect(256,59,c.hp_max*1.2,21,"red",0,"start"),h.drawRect(256,59,c.hp*1.2,21,"yellow",0,"start")};window.onload=Ye;
