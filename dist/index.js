const A=(e,t)=>{e()||(t(),requestAnimationFrame(()=>A(e,t)))},F=(e,t,d=0)=>{d<e&&(t(d),requestAnimationFrame(()=>F(e,t,d+1)))},z=e=>{e(),requestAnimationFrame(()=>z(e))},I=[{type:"image",name:"soul",src:"./assets/images/soul.png"},{type:"image",name:"soul_blue",src:"./assets/images/soul_blue.png"},{type:"image",name:"commands",src:"./assets/images/commands.png"},{type:"image",name:"back",src:"./assets/images/back.png"},{type:"image",name:"sans",src:"./assets/images/sans.png"},{type:"image",name:"hp_kr_purple",src:"./assets/images/hp_kr_purple.png"},{type:"image",name:"determination_white",src:"./assets/images/font/determination_white.png"},{type:"image",name:"determination_red",src:"./assets/images/font/determination_red.png"},{type:"image",name:"determination_orange",src:"./assets/images/font/determination_orange.png"},{type:"image",name:"determination_blue",src:"./assets/images/font/determination_blue.png"},{type:"image",name:"determination_yellow",src:"./assets/images/font/determination_yellow.png"},{type:"image",name:"status_white",src:"./assets/images/font/status_white.png"},{type:"image",name:"status_red",src:"./assets/images/font/status_red.png"},{type:"image",name:"status_orange",src:"./assets/images/font/status_orange.png"},{type:"image",name:"status_blue",src:"./assets/images/font/status_blue.png"},{type:"image",name:"status_yellow",src:"./assets/images/font/status_yellow.png"},{type:"image",name:"status_purple",src:"./assets/images/font/status_purple.png"},{type:"image",name:"hp_kr_white",src:"./assets/images/hp_kr_white.png"},{type:"image",name:"hp_kr_red",src:"./assets/images/hp_kr_red.png"},{type:"image",name:"hp_kr_purple",src:"./assets/images/hp_kr_purple.png"},{type:"image",name:"bone_head_white",src:"./assets/images/bone_head_white.png"},{type:"image",name:"bananahexagon",src:"./assets/images/normal_icon.png"}],L=async()=>{const e={},t={},d={},w=I,i=[];return console.log(w),w.forEach(u=>i.push(new Promise(r=>{switch(u.type){case"image":{const g=new Image;g.src=u.src,g.onload=()=>{e[u.name]=g,r()}}break;case"audio":{const g=new Audio;g.src=u.src,g.onload=()=>{t[u.name]=g,r()}}break;case"font":(async()=>{const o=await(await(await fetch(u.src)).text()).match(/url\(.+?\)/g);if(!o)throw new Error("フォントが見つかりませんでした");const a=[];o.forEach(p=>{a.push((async()=>{const h=new FontFace(u.name,p);await h.load(),d[u.name]=h,await document.fonts.add(h)})())}),Promise.all(a)})().then(r)}}))),await Promise.all(i),console.log(d),{Images:e,Audios:t,Fonts:d}},k=e=>Math.sin(e/360*Math.PI*2),$=e=>Math.cos(e/360*Math.PI*2),x=(e,t,d,w,i,u)=>{const r=(a,p,h,s=0,c=100,n=1,l="center",y,m=!1)=>{if(m){const _=d[a],[q,P,v,M]=y===void 0?[0,0,_.width,_.height]:[y.left,y.top,y.width,y.height];switch(t.globalAlpha=n,l){case"center":t.save(),t.translate(p*i.display_quality,-h*i.display_quality+e.height),t.rotate(s*Math.PI/180),t.drawImage(_,q,P,v,M,-v*c/200*i.display_quality,-M*c/200*i.display_quality,v*c/100*i.display_quality,M*c/100*i.display_quality),t.restore();break;case"start":t.save(),t.translate(p*i.display_quality,-h*i.display_quality+e.height),t.rotate(s*Math.PI/180),t.drawImage(_,q,P,v,M,0,0,v*c/100*i.display_quality,M*c/100*i.display_quality),t.restore()}}else{const _=($(u.d)*p-k(u.d)*h+u.x)*u.size/100,q=(k(u.d)*p+$(u.d)*h+u.y)*u.size/100,P=s+u.d;r(a,_,q,P,c*u.size/100,n,l,y,!0)}};return{stamp:r,drawRect:(a,p,h,s,c,n=0,l="center")=>{switch(t.save(),l){case"center++":t.translate(a*i.display_quality,-p*i.display_quality+e.height),t.rotate(n*Math.PI/180),t.beginPath(),t.rect(-h/2*i.display_quality,-s/2*i.display_quality,h*i.display_quality,s*i.display_quality);break;case"center":t.translate((a-h/2)*i.display_quality,-(p-s/2)*i.display_quality+e.height),t.rotate(n*Math.PI/180),t.beginPath(),t.rect(0,0,h*i.display_quality,-s*i.display_quality);break;case"start":default:t.translate(a*i.display_quality,-p*i.display_quality+e.height),t.rotate(n*Math.PI/180),t.beginPath(),t.rect(0,0,h*i.display_quality,-s*i.display_quality);break}t.fillStyle=c,t.fill(),t.restore()},drawLine:(a,p,h,s,c,n,l=0)=>{switch(t.beginPath(),l){case 0:t.moveTo((a-s*Math.sin(h)/2)*i.display_quality,-(p+s*Math.cos(h)/2)*i.display_quality+e.height),t.lineTo((a+s*Math.sin(h)/2)*i.display_quality,-(p-s*Math.cos(h)/2)*i.display_quality+e.height);break;case 1:t.moveTo(a*i.display_quality,-p*i.display_quality+e.height),t.lineTo((a+s*Math.sin(h))*i.display_quality,-(p-s*Math.cos(h))*i.display_quality+e.height);break}t.strokeStyle=n,t.lineWidth=c*i.display_quality,t.stroke()},drawText:(a,p,h,s,c,n="serif",l="left")=>{const[y,m]=[p*i.display_quality,-h*i.display_quality+e.height];t.font=`${s*i.display_quality}px ${n}`,t.textAlign=l,t.fillStyle=c,t.fillText(a,y,m)}}},D=e=>{class t{constructor(w,i,u=0,r=100,g="",f=!1){this.x=w,this.y=i,this.d=u,this.size=r,this.costume=g,this.visible=f}stamp(){this.visible&&e.stamp(this.costume,this.x,this.y,this.d,this.size)}move(w){this.x+=k(this.d)*w,this.y+=$(this.d)*w}}return t},E=(e,t,d)=>({raw_to_stage:(i,u,r=0)=>{const g=e.getBoundingClientRect(),f=((i-g.left)/d.size*100-d.x)*t.stage_width/t.display_width,o=(t.display_height-((u-g.top)/d.size*100-d.y))*t.stage_height/t.display_height,a=r+d.d;return{x:f,y:o,d:a}}}),S=async e=>{const t=document.getElementById(e.canvas_name);t.height=e.stage_height*e.display_quality,t.width=e.stage_width*e.display_quality;const d=t.getContext("2d"),{Images:w,Audios:i,Fonts:u}=await L(),r={up:!1,down:!1,left:!1,right:!1,z:!1,x:!1,c:!1,d:!1},g={x:0,y:0,clicking:!1,is_in_rect(h,s,c,n,l="center"){switch(l){case"center":return h-c/2<this.x&&this.x<h+c/2&&s-n/2<this.y&&this.y<s+n/2;case"start":default:return h<this.x&&this.x<h+c&&s<this.y&&this.y<s+n}}},f={canvas:{size:100,x:0,y:0,d:0}},o=x(t,d,w,u,e,f.canvas),a=D(o);d.imageSmoothingEnabled=!1;const p=E(t,e,f.canvas);return window.addEventListener("keydown",h=>{switch(h.key){case"ArrowUp":r.up=!0;break;case"ArrowDown":r.down=!0;break;case"ArrowLeft":r.left=!0;break;case"ArrowRight":r.right=!0;break;case"z":case"Z":r.z=!0;break;case"x":case"X":r.x=!0;break;case"c":case"C":r.c=!0;break;case"d":case"D":r.d=!0;break}}),window.addEventListener("keyup",h=>{switch(h.key){case"ArrowUp":r.up=!1;break;case"ArrowDown":r.down=!1;break;case"ArrowLeft":r.left=!1;break;case"ArrowRight":r.right=!1;break;case"z":case"Z":r.z=!1;break;case"x":case"X":r.x=!1;break;case"c":case"C":r.c=!1;break;case"d":case"D":r.d=!1;break}}),t.addEventListener("mousedown",h=>{g.clicking=!0;const s=p.raw_to_stage(h.x,h.y);g.x=s.x,g.y=s.y}),t.addEventListener("mousemove",h=>{const s=p.raw_to_stage(h.x,h.y);g.x=s.x,g.y=s.y}),t.addEventListener("mouseup",h=>{g.clicking=!1;const s=p.raw_to_stage(h.x,h.y);g.x=s.x,g.y=s.y}),{canvas:t,ctx:d,Images:w,Audios:i,Fonts:u,inputKeys:r,inputMouse:g,props:f,cLib:o,Sprite:a,for:F,while:A,loop:z}},R=2,T=640,B=480,G=800,C=400,K="canvas",U={display_quality:R,stage_width:T,stage_height:B,display_width:G,display_height:C,canvas_name:K},W=(e,t)=>{let d={};const w=class b extends t{constructor(g,f,o,a,p,h,s,c,n,l){super(g,f,o,a,void 0,!0),this.start_x=g,this.start_y=f,this.start_d=o,this.move_x=h,this.move_y=s,this.move_d=c,this.start_len=p,this.move_len=n,this.len=p,this.age=0,this.id=b.current_id,this.width=a,d[this.id]=this,b.current_id++}move_self(){this.age++,this.x=this.start_x+b.get_move(this.move_x,this.age),this.y=this.start_y+b.get_move(this.move_y,this.age),this.d=this.start_d+b.get_move(this.move_d,this.age),this.len=this.start_len+b.get_move(this.move_len,this.age)}draw(){$(this.d),e.stamp("bone_head_white",this.x+$(this.d)*this.width*8/6,this.y-k(this.d)*this.width*8/6,this.d+180,this.width*100/6,1,"start"),e.drawRect(this.x+k(this.d)*this.width*7/6,this.y+$(this.d)*this.width*7/6,this.width,this.len,"white",this.d,"start"),e.stamp("bone_head_white",this.x+k(this.d)*(this.len+this.width*14/6)-$(this.d)*this.width*2/6,this.y+$(this.d)*(this.len+this.width*14/6)+k(this.d)*this.width*2/6,this.d,this.width*100/6,1,"start")}static process(){for(const g in d){const f=d[g];f.move_self(),f.draw()}}static get_move(g,f){if(typeof g=="number")return g*f;switch(g.type){case"sin":case"cos":return 0;case"custom":return g.fn(f)}}};w.current_id=0;let i=w;return{boneDict:d,normal:i,process:()=>{i.process()}}},X={height_basic:15,width_basic:2,name:"determination"},Z={left:10,up:34,width:6,height:9,gap:0},j={left:20,up:34,width:6,height:9,gap:0},H={left:30,up:34,width:6,height:9,gap:0},J={left:40,up:34,width:6,height:9,gap:0},N={left:50,up:34,width:6,height:9,gap:0},O={left:60,up:34,width:6,height:9,gap:0},Q={left:70,up:34,width:6,height:9,gap:0},V={left:80,up:34,width:6,height:9,gap:0},Y={left:90,up:34,width:6,height:9,gap:0},tt={left:100,up:34,width:6,height:9,gap:0},et={left:110,up:34,width:6,height:9,gap:0},ht={left:120,up:34,width:6,height:9,gap:0},it={left:130,up:34,width:7,height:9,gap:0},st={left:140,up:34,width:6,height:9,gap:0},at={left:150,up:34,width:6,height:9,gap:0},pt={left:0,up:50,width:6,height:9,gap:0},nt={left:10,up:50,width:6,height:9,gap:0},gt={left:20,up:50,width:6,height:9,gap:0},lt={left:30,up:50,width:6,height:9,gap:0},ot={left:40,up:50,width:6,height:9,gap:0},dt={left:50,up:50,width:6,height:9,gap:0},rt={left:60,up:50,width:6,height:9,gap:0},ut={left:70,up:50,width:7,height:9,gap:0},ct={left:80,up:50,width:6,height:9,gap:0},wt={left:90,up:50,width:6,height:9,gap:0},ft={left:100,up:50,width:6,height:9,gap:0},_t={left:10,up:68,width:6,height:7,gap:2},yt={left:20,up:66,width:6,height:9,gap:0},mt={left:30,up:68,width:6,height:7,gap:2},$t={left:40,up:66,width:6,height:9,gap:0},bt={left:50,up:68,width:6,height:7,gap:2},kt={left:60,up:66,width:6,height:9,gap:0},qt={left:70,up:68,width:6,height:10,gap:5},vt={left:80,up:66,width:6,height:9,gap:0},Mt={left:90,up:65,width:6,height:10,gap:-1},Pt={left:100,up:65,width:6,height:13,gap:2},At={left:110,up:66,width:6,height:9,gap:0},Ft={left:120,up:66,width:6,height:9,gap:0},zt={left:130,up:68,width:7,height:7,gap:2},It={left:140,up:68,width:6,height:7,gap:2},Lt={left:150,up:68,width:6,height:7,gap:2},xt={left:0,up:84,width:6,height:10,gap:5},Dt={left:10,up:84,width:6,height:10,gap:5},Et={left:20,up:84,width:6,height:7,gap:2},St={left:30,up:84,width:6,height:7,gap:2},Rt={left:40,up:82,width:6,height:9,gap:0},Tt={left:50,up:84,width:6,height:7,gap:2},Bt={left:60,up:84,width:6,height:7,gap:2},Gt={left:70,up:84,width:7,height:7,gap:2},Ct={left:80,up:84,width:6,height:7,gap:2},Kt={left:90,up:84,width:6,height:10,gap:5},Ut={left:100,up:84,width:6,height:7,gap:2},Wt={left:0,up:0,width:1,height:1,gap:0},Xt={left:150,up:82,width:6,height:9,gap:0},Zt={left:40,up:0,width:6,height:13,gap:0},jt={left:150,up:61,width:4,height:1,gap:14},Ht={0:{left:0,up:18,width:6,height:9,gap:0},1:{left:10,up:18,width:6,height:9,gap:0},2:{left:20,up:18,width:6,height:9,gap:0},3:{left:30,up:18,width:6,height:9,gap:0},4:{left:40,up:18,width:6,height:9,gap:0},5:{left:50,up:18,width:6,height:9,gap:0},6:{left:60,up:18,width:6,height:9,gap:0},7:{left:70,up:18,width:6,height:9,gap:0},8:{left:80,up:18,width:6,height:9,gap:0},9:{left:90,up:18,width:6,height:9,gap:0},props:X,A:Z,B:j,C:H,D:J,E:N,F:O,G:Q,H:V,I:Y,J:tt,K:et,L:ht,M:it,N:st,O:at,P:pt,Q:nt,R:gt,S:lt,T:ot,U:dt,V:rt,W:ut,X:ct,Y:wt,Z:ft,a:_t,b:yt,c:mt,d:$t,e:bt,f:kt,g:qt,h:vt,i:Mt,j:Pt,k:At,l:Ft,m:zt,n:It,o:Lt,p:xt,q:Dt,r:Et,s:St,t:Rt,u:Tt,v:Bt,w:Gt,x:Ct,y:Kt,z:Ut,space:Wt,irregular:Xt,"!":{left:10,up:1,width:4,height:10,gap:-1},'"':{left:20,up:2,width:5,height:4,gap:-5},"#":{left:30,up:2,width:7,height:9,gap:0},$:Zt,"%":{left:50,up:2,width:7,height:9,gap:0},"&":{left:60,up:2,width:7,height:9,gap:0},"'":{left:70,up:2,width:2,height:4,gap:-5},"(":{left:80,up:2,width:4,height:9,gap:0},")":{left:90,up:2,width:4,height:9,gap:0},"*":{left:100,up:4,width:8,height:5,gap:0},"+":{left:110,up:4,width:6,height:5,gap:0},",":{left:120,up:9,width:2,height:4,gap:7},"-":{left:130,up:6,width:5,height:1,gap:0},".":{left:140,up:9,width:2,height:2,gap:7},"/":{left:150,up:2,width:6,height:10,gap:1},":":{left:100,up:20,width:2,height:7,gap:2},";":{left:110,up:20,width:2,height:9,gap:4},"<":{left:120,up:18,width:5,height:9,gap:0},"=":{left:130,up:21,width:5,height:3,gap:0},">":{left:140,up:18,width:5,height:9,gap:0},"?":{left:150,up:18,width:6,height:9,gap:0},"@":{left:0,up:34,width:6,height:9,gap:0},"[":{left:110,up:50,width:4,height:9,gap:0},"\\":{left:120,up:50,width:6,height:10,gap:1},"]":{left:130,up:50,width:4,height:9,gap:0},"^":{left:140,up:49,width:6,height:4,gap:-5},_:jt,"`":{left:10,up:68,width:3,height:2,gap:2},"{":{left:110,up:82,width:5,height:9,gap:0},"|":{left:120,up:82,width:2,height:9,gap:0},"}":{left:130,up:82,width:5,height:9,gap:0},"~":{left:140,up:85,width:7,height:2,gap:-1}},Jt={height_basic:6,width_basic:1,name:"status"},Nt={left:6,up:14,width:4,height:5,gap:0},Ot={left:12,up:14,width:4,height:5,gap:0},Qt={left:18,up:14,width:4,height:5,gap:0},Vt={left:24,up:14,width:4,height:5,gap:0},Yt={left:30,up:14,width:4,height:5,gap:0},te={left:36,up:14,width:4,height:5,gap:0},ee={left:42,up:14,width:4,height:5,gap:0},he={left:48,up:14,width:4,height:5,gap:0},ie={left:54,up:14,width:4,height:5,gap:0},se={left:60,up:14,width:4,height:5,gap:0},ae={left:66,up:14,width:4,height:5,gap:0},pe={left:72,up:14,width:4,height:5,gap:0},ne={left:78,up:14,width:5,height:5,gap:0},ge={left:84,up:14,width:4,height:5,gap:0},le={left:90,up:14,width:4,height:5,gap:0},oe={left:0,up:21,width:4,height:5,gap:0},de={left:6,up:21,width:4,height:5,gap:0},re={left:12,up:21,width:4,height:5,gap:0},ue={left:18,up:21,width:4,height:5,gap:0},ce={left:24,up:21,width:4,height:5,gap:0},we={left:30,up:21,width:4,height:5,gap:0},fe={left:36,up:21,width:4,height:5,gap:0},_e={left:42,up:21,width:5,height:5,gap:0},ye={left:48,up:21,width:4,height:5,gap:0},me={left:54,up:21,width:4,height:5,gap:0},$e={left:60,up:21,width:4,height:5,gap:0},be={left:6,up:28,width:4,height:5,gap:0},ke={left:12,up:28,width:4,height:5,gap:0},qe={left:18,up:28,width:4,height:5,gap:0},ve={left:24,up:28,width:4,height:5,gap:0},Me={left:30,up:28,width:4,height:5,gap:0},Pe={left:36,up:28,width:4,height:5,gap:0},Ae={left:42,up:28,width:4,height:5,gap:0},Fe={left:48,up:28,width:4,height:5,gap:0},ze={left:54,up:28,width:4,height:5,gap:0},Ie={left:60,up:28,width:4,height:5,gap:0},Le={left:66,up:28,width:4,height:5,gap:0},xe={left:72,up:28,width:4,height:5,gap:0},De={left:78,up:28,width:5,height:5,gap:0},Ee={left:84,up:28,width:4,height:5,gap:0},Se={left:90,up:28,width:4,height:5,gap:0},Re={left:0,up:35,width:4,height:5,gap:0},Te={left:6,up:35,width:4,height:5,gap:0},Be={left:12,up:35,width:4,height:5,gap:0},Ge={left:18,up:35,width:4,height:5,gap:0},Ce={left:24,up:35,width:4,height:5,gap:0},Ke={left:30,up:35,width:4,height:5,gap:0},Ue={left:36,up:35,width:4,height:5,gap:0},We={left:42,up:35,width:5,height:5,gap:0},Xe={left:48,up:35,width:4,height:5,gap:0},Ze={left:54,up:35,width:4,height:5,gap:0},je={left:60,up:35,width:4,height:5,gap:0},He={left:0,up:0,width:4,height:1,gap:0},Je={left:90,up:35,width:4,height:5,gap:0},Ne={left:24,up:0,width:5,height:5,gap:0},Oe={left:90,up:25,width:4,height:1,gap:4},Qe={0:{left:0,up:7,width:4,height:5,gap:0},1:{left:6,up:7,width:4,height:5,gap:0},2:{left:12,up:7,width:4,height:5,gap:0},3:{left:18,up:7,width:4,height:5,gap:0},4:{left:24,up:7,width:4,height:5,gap:0},5:{left:30,up:7,width:4,height:5,gap:0},6:{left:36,up:7,width:4,height:5,gap:0},7:{left:42,up:7,width:4,height:5,gap:0},8:{left:48,up:7,width:4,height:5,gap:0},9:{left:54,up:7,width:4,height:5,gap:0},props:Jt,A:Nt,B:Ot,C:Qt,D:Vt,E:Yt,F:te,G:ee,H:he,I:ie,J:se,K:ae,L:pe,M:ne,N:ge,O:le,P:oe,Q:de,R:re,S:ue,T:ce,U:we,V:fe,W:_e,X:ye,Y:me,Z:$e,a:be,b:ke,c:qe,d:ve,e:Me,f:Pe,g:Ae,h:Fe,i:ze,j:Ie,k:Le,l:xe,m:De,n:Ee,o:Se,p:Re,q:Te,r:Be,s:Ge,t:Ce,u:Ke,v:Ue,w:We,x:Xe,y:Ze,z:je,space:He,irregular:Je,"!":{left:6,up:0,width:4,height:5,gap:0},'"':{left:12,up:0,width:3,height:2,gap:0},"#":{left:18,up:0,width:5,height:5,gap:0},$:Ne,"%":{left:30,up:1,width:4,height:4,gap:1},"&":{left:36,up:0,width:5,height:5,gap:0},"'":{left:42,up:0,width:1,height:2,gap:-3},"(":{left:48,up:0,width:3,height:5,gap:0},")":{left:54,up:0,width:3,height:5,gap:0},"*":{left:60,up:0,width:5,height:5,gap:0},"+":{left:66,up:0,width:5,height:5,gap:0},",":{left:72,up:3,width:1,height:2,gap:3},"-":{left:78,up:2,width:5,height:1,gap:0},".":{left:84,up:4,width:1,height:1,gap:4},"/":{left:90,up:1,width:4,height:4,gap:1},":":{left:60,up:8,width:1,height:3,gap:0},";":{left:66,up:8,width:1,height:4,gap:1},"<":{left:72,up:7,width:3,height:5,gap:0},"=":{left:78,up:8,width:5,height:3,gap:0},">":{left:84,up:7,width:3,height:5,gap:0},"?":{left:90,up:7,width:4,height:5,gap:0},"@":{left:0,up:14,width:4,height:5,gap:0},"[":{left:66,up:21,width:4,height:5,gap:0},"\\":{left:72,up:22,width:4,height:4,gap:1},"]":{left:78,up:21,width:4,height:5,gap:0},"^":{left:84,up:21,width:5,height:3,gap:-1},_:Oe,"`":{left:0,up:27,width:1,height:2,gap:-5},"{":{left:66,up:35,width:3,height:5,gap:0},"|":{left:72,up:35,width:1,height:5,gap:0},"}":{left:78,up:35,width:3,height:5,gap:0},"~":{left:84,up:35,width:4,height:2,gap:-3}},Ve=(e,t)=>{const d={en:Ht,status:Qe};let w={};class i{constructor(o){this.name=o}delete(){delete w[this.name]}}class u extends i{constructor(o,a,p,h,s,c,n){super(o),this._={all_str:n.reduce((l,y)=>l+y.str,""),now:[{str:"",color:n[0].color,spacing_x:n[0].spacing_x,spacing_y:n[0].spacing_y}],len_allow:0,count:0,current_char:0,current_char_true:0},this.x=a,this.y=p,this.direction=h,this.size=s,this.data=n,this.font=(l=>{switch(l){case"status":return d.status;default:return d.en}})(c),w[o]=this,this.process()}write(){const o=this.size,a=this.direction*Math.PI/180,p=this._.now.reduce((l,y)=>l+y.str.length,0);let h=0,s=0,c=0;const n=l=>l in this.font?this.font[l]:this.font.space;return this._.now.forEach(l=>{l.str.split("").forEach(m=>{const _=n(m);m==`
`?(h=0,s+=this.font.props.height_basic+l.spacing_y):(e.stamp(this.font.props.name+"_"+l.color,this.x+(Math.cos(a)*h-Math.sin(a)*(s+_.gap/2))*o/100,this.y+(Math.sin(a)*h+Math.cos(a)*(s+_.gap/2))*o/100,this.direction,o,1,"start",{left:_.left,top:_.up,width:_.width,height:_.height}),c+1<p&&(h+=(_.width+n(this._.all_str[c+1]).width)/2+this.font.props.width_basic+l.spacing_x)),c++})}),this}process(){const o=this.data.reduce((a,p)=>a+p.str.length,0);if(this._.len_allow==o&&t.z){delete w[this.name];return}else t.x?(this._.len_allow=o,this._.current_char=o):this._.len_allow<o&&(this._.len_allow+=1/this.data[this._.count].speed,this._.current_char+=1/this.data[this._.count].speed);for(;this._.current_char_true<Math.min(this._.len_allow,o);)for(this._.now[this._.count].str+=this.data[this._.count].str[this._.now[this._.count].str.length],this._.current_char_true++;this.data[this._.count].str.length<=this._.now[this._.count].str.length&&this._.count+1<this.data.length;)this._.count++,this._.now.push({str:"",color:this.data[this._.count].color===void 0?"white":this.data[this._.count].color,spacing_x:this.data[this._.count].spacing_x,spacing_y:this.data[this._.count].spacing_y}),this._.current_char-=this.data[this._.count].str.length}}class r extends i{constructor(o,a,p,h,s,c,n,l,y,m,_){super(o),this.str_now="",this.len_now=0,this.str=a,this.x=p,this.y=h,this.direction=s,this.size=c,this.color=n,this.spacing_x=l,this.spacing_y=y,this.speed=m,this.font=(q=>{switch(q){case"status":return d.status;default:return d.en}})(_),this.len_allow=0,w[o]=this,this.process()}write(){const o=this.str_now,a=this.size,p=this.direction*Math.PI/180;let h,s;[h,s]=[0,0];const c=n=>n in this.font?this.font[n]:this.font.space;for(let n=0;n<o.length;n++){const l=c(o[n]);o[n]==`
`?(h=0,s+=this.font.props.height_basic+this.spacing_y):(e.stamp(this.font.props.name+"_"+(this.color?this.color:"white"),this.x+(Math.cos(p)*h-Math.sin(p)*(s-l.gap))*a/100,this.y+(Math.sin(p)*h+Math.cos(p)*(s-l.gap))*a/100,this.direction,a,1,"start",{left:l.left,top:l.up,width:l.width,height:l.height}),n+1<o.length&&(h+=l.width+this.font.props.width_basic+this.spacing_x))}return this}process(){if(this.len_allow==this.str.length&&t.z){delete w[this.name];return}else t.x?this.len_allow=this.str.length:this.len_allow<this.str.length&&(this.len_allow+=1/this.speed);for(;this.str_now.length<Math.min(this.len_allow,this.str.length);)this.str_now+=this.str[this.str_now.length]}}return{Super:u,Plane:r,process:()=>{for(const f in w)w[f].process()},dict:w}},Ye=async()=>{const e=await S(U),t=new e.Sprite(0,0,0,80,"soul",!0),d=W(e.cLib,e.Sprite),w=Ve(e.cLib,e.inputKeys);new d.normal(60,180,0,12,200,0,0,2,0,0);let i=new w.Plane("test","Hello, world!",60,180,0,400,"white",0,0,5,"en");e.loop(()=>{e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.inputKeys.up&&(t.y+=3.5),e.inputKeys.down&&(t.y-=3.5),e.inputKeys.right&&(t.x+=3.5),e.inputKeys.left&&(t.x-=3.5),d.process(),w.process(),i.write(),t.stamp()})};window.onload=Ye;
