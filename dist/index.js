const z=(i,t)=>{i()||(t(),requestAnimationFrame(()=>z(i,t)))},P=(i,t,u=0)=>{u<i&&(t(u),requestAnimationFrame(()=>P(i,t,u+1)))},F=i=>{i(),requestAnimationFrame(()=>F(i))},A=[{type:"image",name:"soul",src:"./assets/images/soul.png"},{type:"image",name:"soul_blue",src:"./assets/images/soul_blue.png"},{type:"image",name:"commands",src:"./assets/images/commands.png"},{type:"image",name:"back",src:"./assets/images/back.png"},{type:"image",name:"sans",src:"./assets/images/sans.png"},{type:"image",name:"hp_kr_purple",src:"./assets/images/hp_kr_purple.png"},{type:"image",name:"determination_white",src:"./assets/images/font/determination_white.png"},{type:"image",name:"determination_red",src:"./assets/images/font/determination_red.png"},{type:"image",name:"determination_orange",src:"./assets/images/font/determination_orange.png"},{type:"image",name:"determination_blue",src:"./assets/images/font/determination_blue.png"},{type:"image",name:"determination_yellow",src:"./assets/images/font/determination_yellow.png"},{type:"image",name:"status_white",src:"./assets/images/font/status_white.png"},{type:"image",name:"status_red",src:"./assets/images/font/status_red.png"},{type:"image",name:"status_orange",src:"./assets/images/font/status_orange.png"},{type:"image",name:"status_blue",src:"./assets/images/font/status_blue.png"},{type:"image",name:"status_yellow",src:"./assets/images/font/status_yellow.png"},{type:"image",name:"status_purple",src:"./assets/images/font/status_purple.png"},{type:"image",name:"hp_kr_white",src:"./assets/images/hp_kr_white.png"},{type:"image",name:"hp_kr_red",src:"./assets/images/hp_kr_red.png"},{type:"image",name:"hp_kr_purple",src:"./assets/images/hp_kr_purple.png"},{type:"image",name:"bone_head_white",src:"./assets/images/bone_head_white.png"},{type:"image",name:"bananahexagon",src:"./assets/images/normal_icon.png"}],E=async()=>{const i={},t={},u={},w=A,n=[];return console.log(w),w.forEach(e=>n.push(new Promise(s=>{switch(e.type){case"image":{const a=new Image;a.src=e.src,a.onload=()=>{i[e.name]=a,s()}}break;case"audio":{const a=new Audio;a.src=e.src,a.onload=()=>{t[e.name]=a,s()}}break;case"font":(async()=>{const g=await(await(await fetch(e.src)).text()).match(/url\(.+?\)/g);if(!g)throw new Error("フォントが見つかりませんでした");const d=[];g.forEach(o=>{d.push((async()=>{const h=new FontFace(e.name,o);await h.load(),u[e.name]=h,await document.fonts.add(h)})())}),Promise.all(d)})().then(s)}}))),await Promise.all(n),console.log(u),{Images:i,Audios:t,Fonts:u}},_=i=>Math.sin(i/360*Math.PI*2),y=i=>Math.cos(i/360*Math.PI*2),I=(i,t,u,w,n,e)=>{const s=(d,o,h,l=0,f=100,r=1,c="center",b,$=!1)=>{if($){const m=u[d],[k,M,q,v]=b===void 0?[0,0,m.width,m.height]:[b.left,b.top,b.width,b.height];switch(t.globalAlpha=r,c){case"center":t.save(),t.translate(o*n.display_quality,-h*n.display_quality+i.height),t.rotate(l*Math.PI/180),t.drawImage(m,k,M,q,v,-q*f/200*n.display_quality,-v*f/200*n.display_quality,q*f/100*n.display_quality,v*f/100*n.display_quality),t.restore();break;case"start":t.save(),t.translate(o*n.display_quality,-h*n.display_quality+i.height),t.rotate(l*Math.PI/180),t.drawImage(m,k,M,q,v,0,0,q*f/100*n.display_quality,v*f/100*n.display_quality),t.restore()}}else{const m=(y(e.d)*o-_(e.d)*h+e.x)*e.size/100,k=(_(e.d)*o+y(e.d)*h+e.y)*e.size/100,M=l+e.d;s(d,m,k,M,f*e.size/100,r,c,b,!0)}};return{stamp:s,drawRect:(d,o,h,l,f,r=0,c="center")=>{switch(t.save(),c){case"center++":t.translate(d*n.display_quality,-o*n.display_quality+i.height),t.rotate(r*Math.PI/180),t.beginPath(),t.rect(-h/2*n.display_quality,-l/2*n.display_quality,h*n.display_quality,l*n.display_quality);break;case"center":t.translate((d-h/2)*n.display_quality,-(o-l/2)*n.display_quality+i.height),t.rotate(r*Math.PI/180),t.beginPath(),t.rect(0,0,h*n.display_quality,-l*n.display_quality);break;case"start":default:t.translate(d*n.display_quality,-o*n.display_quality+i.height),t.rotate(r*Math.PI/180),t.beginPath(),t.rect(0,0,h*n.display_quality,-l*n.display_quality);break}t.fillStyle=f,t.fill(),t.restore()},drawLine:(d,o,h,l,f,r,c=0)=>{switch(t.beginPath(),c){case 0:t.moveTo((d-l*Math.sin(h)/2)*n.display_quality,-(o+l*Math.cos(h)/2)*n.display_quality+i.height),t.lineTo((d+l*Math.sin(h)/2)*n.display_quality,-(o-l*Math.cos(h)/2)*n.display_quality+i.height);break;case 1:t.moveTo(d*n.display_quality,-o*n.display_quality+i.height),t.lineTo((d+l*Math.sin(h))*n.display_quality,-(o-l*Math.cos(h))*n.display_quality+i.height);break}t.strokeStyle=r,t.lineWidth=f*n.display_quality,t.stroke()},drawText:(d,o,h,l,f,r="serif",c="left")=>{const[b,$]=[o*n.display_quality,-h*n.display_quality+i.height];t.font=`${l*n.display_quality}px ${r}`,t.textAlign=c,t.fillStyle=f,t.fillText(d,b,$)}}},D=i=>{class t{constructor(w,n,e=0,s=100,a="",p=!1){this.x=w,this.y=n,this.d=e,this.size=s,this.costume=a,this.visible=p}stamp(){this.visible&&i.stamp(this.costume,this.x,this.y,this.d,this.size)}move(w){this.x+=_(this.d)*w,this.y+=y(this.d)*w}}return t},L=(i,t,u)=>({raw_to_stage:(n,e,s=0)=>{const a=i.getBoundingClientRect(),p=((n-a.left)/u.size*100-u.x)*t.stage_width/t.display_width,g=(t.display_height-((e-a.top)/u.size*100-u.y))*t.stage_height/t.display_height,d=s+u.d;return{x:p,y:g,d}}}),R=async i=>{const t=document.getElementById(i.canvas_name);t.height=i.stage_height*i.display_quality,t.width=i.stage_width*i.display_quality;const u=t.getContext("2d"),{Images:w,Audios:n,Fonts:e}=await E(),s={up:!1,down:!1,left:!1,right:!1,z:!1,x:!1,c:!1,d:!1},a={x:0,y:0,clicking:!1,is_in_rect(h,l,f,r,c="center"){switch(c){case"center":return h-f/2<this.x&&this.x<h+f/2&&l-r/2<this.y&&this.y<l+r/2;case"start":default:return h<this.x&&this.x<h+f&&l<this.y&&this.y<l+r}}},p={canvas:{size:100,x:0,y:0,d:0}},g=I(t,u,w,e,i,p.canvas),d=D(g);u.imageSmoothingEnabled=!1;const o=L(t,i,p.canvas);return window.addEventListener("keydown",h=>{switch(h.key){case"ArrowUp":s.up=!0;break;case"ArrowDown":s.down=!0;break;case"ArrowLeft":s.left=!0;break;case"ArrowRight":s.right=!0;break;case"z":case"Z":s.z=!0;break;case"x":case"X":s.x=!0;break;case"c":case"C":s.c=!0;break;case"d":case"D":s.d=!0;break}}),window.addEventListener("keyup",h=>{switch(h.key){case"ArrowUp":s.up=!1;break;case"ArrowDown":s.down=!1;break;case"ArrowLeft":s.left=!1;break;case"ArrowRight":s.right=!1;break;case"z":case"Z":s.z=!1;break;case"x":case"X":s.x=!1;break;case"c":case"C":s.c=!1;break;case"d":case"D":s.d=!1;break}}),t.addEventListener("mousedown",h=>{a.clicking=!0;const l=o.raw_to_stage(h.x,h.y);a.x=l.x,a.y=l.y}),t.addEventListener("mousemove",h=>{const l=o.raw_to_stage(h.x,h.y);a.x=l.x,a.y=l.y}),t.addEventListener("mouseup",h=>{a.clicking=!1;const l=o.raw_to_stage(h.x,h.y);a.x=l.x,a.y=l.y}),{canvas:t,ctx:u,Images:w,Audios:n,Fonts:e,inputKeys:s,inputMouse:a,props:p,cLib:g,Sprite:d,for:P,while:z,loop:F}},S=2,B=640,G=480,T=800,j=400,C="canvas",W={display_quality:S,stage_width:B,stage_height:G,display_width:T,display_height:j,canvas_name:C},K=(i,t)=>{let u={};const w=class x extends t{constructor(a,p,g,d,o,h,l,f,r,c){super(a,p,g,d,void 0,!0),this.start_x=a,this.start_y=p,this.start_d=g,this.move_x=h,this.move_y=l,this.move_d=f,this.start_len=o,this.move_len=r,this.len=o,this.age=0,this.id=x.current_id,this.width=d,u[this.id]=this,x.current_id++}move_self(){this.age++,this.x=this.start_x+x.get_move(this.move_x,this.age),this.y=this.start_y+x.get_move(this.move_y,this.age),this.d=this.start_d+x.get_move(this.move_d,this.age),this.len=this.start_len+x.get_move(this.move_len,this.age)}draw(){y(this.d),i.stamp("bone_head_white",this.x+y(this.d)*this.width*8/6,this.y-_(this.d)*this.width*8/6,this.d+180,this.width*100/6,1,"start"),i.drawRect(this.x+_(this.d)*this.width*6/6,this.y+y(this.d)*this.width*6/6,this.width,this.len+this.width*2/6,"white",this.d,"start"),i.stamp("bone_head_white",this.x+_(this.d)*(this.len+this.width*14/6)-y(this.d)*this.width*2/6,this.y+y(this.d)*(this.len+this.width*14/6)+_(this.d)*this.width*2/6,this.d,this.width*100/6,1,"start")}static process(){for(const a in u){const p=u[a];p.move_self(),p.draw()}}static get_move(a,p){if(typeof a=="number")return a*p;switch(a.type){case"sin":case"cos":return _(a.cycle*p)*a.amp;case"custom":return a.fn(p)}}};w.current_id=0;let n=w;return{boneDict:u,normal:n,process:()=>{n.process()}}},U={height_basic:15,width_basic:2,name:"determination"},X={left:10,up:34,width:6,height:9,gap:0},Z={left:20,up:34,width:6,height:9,gap:0},H={left:30,up:34,width:6,height:9,gap:0},J={left:40,up:34,width:6,height:9,gap:0},N={left:50,up:34,width:6,height:9,gap:0},O={left:60,up:34,width:6,height:9,gap:0},Q={left:70,up:34,width:6,height:9,gap:0},V={left:80,up:34,width:6,height:9,gap:0},Y={left:90,up:34,width:6,height:9,gap:0},tt={left:100,up:34,width:6,height:9,gap:0},et={left:110,up:34,width:6,height:9,gap:0},st={left:120,up:34,width:6,height:9,gap:0},it={left:130,up:34,width:7,height:9,gap:0},ht={left:140,up:34,width:6,height:9,gap:0},at={left:150,up:34,width:6,height:9,gap:0},nt={left:0,up:50,width:6,height:9,gap:0},pt={left:10,up:50,width:6,height:9,gap:0},lt={left:20,up:50,width:6,height:9,gap:0},gt={left:30,up:50,width:6,height:9,gap:0},dt={left:40,up:50,width:6,height:9,gap:0},ot={left:50,up:50,width:6,height:9,gap:0},rt={left:60,up:50,width:6,height:9,gap:0},ct={left:70,up:50,width:7,height:9,gap:0},ut={left:80,up:50,width:6,height:9,gap:0},wt={left:90,up:50,width:6,height:9,gap:0},ft={left:100,up:50,width:6,height:9,gap:0},_t={left:10,up:68,width:6,height:7,gap:2},yt={left:20,up:66,width:6,height:9,gap:0},mt={left:30,up:68,width:6,height:7,gap:2},bt={left:40,up:66,width:6,height:9,gap:0},$t={left:50,up:68,width:6,height:7,gap:2},xt={left:60,up:66,width:6,height:9,gap:0},kt={left:70,up:68,width:6,height:10,gap:5},qt={left:80,up:66,width:6,height:9,gap:0},vt={left:90,up:65,width:6,height:10,gap:-1},Mt={left:100,up:65,width:6,height:13,gap:2},zt={left:110,up:66,width:6,height:9,gap:0},Pt={left:120,up:66,width:6,height:9,gap:0},Ft={left:130,up:68,width:7,height:7,gap:2},At={left:140,up:68,width:6,height:7,gap:2},Et={left:150,up:68,width:6,height:7,gap:2},It={left:0,up:84,width:6,height:10,gap:5},Dt={left:10,up:84,width:6,height:10,gap:5},Lt={left:20,up:84,width:6,height:7,gap:2},Rt={left:30,up:84,width:6,height:7,gap:2},St={left:40,up:82,width:6,height:9,gap:0},Bt={left:50,up:84,width:6,height:7,gap:2},Gt={left:60,up:84,width:6,height:7,gap:2},Tt={left:70,up:84,width:7,height:7,gap:2},jt={left:80,up:84,width:6,height:7,gap:2},Ct={left:90,up:84,width:6,height:10,gap:5},Wt={left:100,up:84,width:6,height:7,gap:2},Kt={left:0,up:0,width:1,height:1,gap:0},Ut={left:150,up:82,width:6,height:9,gap:0},Xt={left:40,up:0,width:6,height:13,gap:0},Zt={left:150,up:61,width:4,height:1,gap:14},Ht={0:{left:0,up:18,width:6,height:9,gap:0},1:{left:10,up:18,width:6,height:9,gap:0},2:{left:20,up:18,width:6,height:9,gap:0},3:{left:30,up:18,width:6,height:9,gap:0},4:{left:40,up:18,width:6,height:9,gap:0},5:{left:50,up:18,width:6,height:9,gap:0},6:{left:60,up:18,width:6,height:9,gap:0},7:{left:70,up:18,width:6,height:9,gap:0},8:{left:80,up:18,width:6,height:9,gap:0},9:{left:90,up:18,width:6,height:9,gap:0},props:U,A:X,B:Z,C:H,D:J,E:N,F:O,G:Q,H:V,I:Y,J:tt,K:et,L:st,M:it,N:ht,O:at,P:nt,Q:pt,R:lt,S:gt,T:dt,U:ot,V:rt,W:ct,X:ut,Y:wt,Z:ft,a:_t,b:yt,c:mt,d:bt,e:$t,f:xt,g:kt,h:qt,i:vt,j:Mt,k:zt,l:Pt,m:Ft,n:At,o:Et,p:It,q:Dt,r:Lt,s:Rt,t:St,u:Bt,v:Gt,w:Tt,x:jt,y:Ct,z:Wt,space:Kt,irregular:Ut,"!":{left:10,up:1,width:4,height:10,gap:-1},'"':{left:20,up:2,width:5,height:4,gap:-5},"#":{left:30,up:2,width:7,height:9,gap:0},$:Xt,"%":{left:50,up:2,width:7,height:9,gap:0},"&":{left:60,up:2,width:7,height:9,gap:0},"'":{left:70,up:2,width:2,height:4,gap:-5},"(":{left:80,up:2,width:4,height:9,gap:0},")":{left:90,up:2,width:4,height:9,gap:0},"*":{left:100,up:4,width:8,height:5,gap:0},"+":{left:110,up:4,width:6,height:5,gap:0},",":{left:120,up:9,width:2,height:4,gap:7},"-":{left:130,up:6,width:5,height:1,gap:0},".":{left:140,up:9,width:2,height:2,gap:7},"/":{left:150,up:2,width:6,height:10,gap:1},":":{left:100,up:20,width:2,height:7,gap:2},";":{left:110,up:20,width:2,height:9,gap:4},"<":{left:120,up:18,width:5,height:9,gap:0},"=":{left:130,up:21,width:5,height:3,gap:0},">":{left:140,up:18,width:5,height:9,gap:0},"?":{left:150,up:18,width:6,height:9,gap:0},"@":{left:0,up:34,width:6,height:9,gap:0},"[":{left:110,up:50,width:4,height:9,gap:0},"\\":{left:120,up:50,width:6,height:10,gap:1},"]":{left:130,up:50,width:4,height:9,gap:0},"^":{left:140,up:49,width:6,height:4,gap:-5},_:Zt,"`":{left:10,up:68,width:3,height:2,gap:2},"{":{left:110,up:82,width:5,height:9,gap:0},"|":{left:120,up:82,width:2,height:9,gap:0},"}":{left:130,up:82,width:5,height:9,gap:0},"~":{left:140,up:85,width:7,height:2,gap:-1}},Jt={height_basic:6,width_basic:1,name:"status"},Nt={left:6,up:14,width:4,height:5,gap:0},Ot={left:12,up:14,width:4,height:5,gap:0},Qt={left:18,up:14,width:4,height:5,gap:0},Vt={left:24,up:14,width:4,height:5,gap:0},Yt={left:30,up:14,width:4,height:5,gap:0},te={left:36,up:14,width:4,height:5,gap:0},ee={left:42,up:14,width:4,height:5,gap:0},se={left:48,up:14,width:4,height:5,gap:0},ie={left:54,up:14,width:4,height:5,gap:0},he={left:60,up:14,width:4,height:5,gap:0},ae={left:66,up:14,width:4,height:5,gap:0},ne={left:72,up:14,width:4,height:5,gap:0},pe={left:78,up:14,width:5,height:5,gap:0},le={left:84,up:14,width:4,height:5,gap:0},ge={left:90,up:14,width:4,height:5,gap:0},de={left:0,up:21,width:4,height:5,gap:0},oe={left:6,up:21,width:4,height:5,gap:0},re={left:12,up:21,width:4,height:5,gap:0},ce={left:18,up:21,width:4,height:5,gap:0},ue={left:24,up:21,width:4,height:5,gap:0},we={left:30,up:21,width:4,height:5,gap:0},fe={left:36,up:21,width:4,height:5,gap:0},_e={left:42,up:21,width:5,height:5,gap:0},ye={left:48,up:21,width:4,height:5,gap:0},me={left:54,up:21,width:4,height:5,gap:0},be={left:60,up:21,width:4,height:5,gap:0},$e={left:6,up:28,width:4,height:5,gap:0},xe={left:12,up:28,width:4,height:5,gap:0},ke={left:18,up:28,width:4,height:5,gap:0},qe={left:24,up:28,width:4,height:5,gap:0},ve={left:30,up:28,width:4,height:5,gap:0},Me={left:36,up:28,width:4,height:5,gap:0},ze={left:42,up:28,width:4,height:5,gap:0},Pe={left:48,up:28,width:4,height:5,gap:0},Fe={left:54,up:28,width:4,height:5,gap:0},Ae={left:60,up:28,width:4,height:5,gap:0},Ee={left:66,up:28,width:4,height:5,gap:0},Ie={left:72,up:28,width:4,height:5,gap:0},De={left:78,up:28,width:5,height:5,gap:0},Le={left:84,up:28,width:4,height:5,gap:0},Re={left:90,up:28,width:4,height:5,gap:0},Se={left:0,up:35,width:4,height:5,gap:0},Be={left:6,up:35,width:4,height:5,gap:0},Ge={left:12,up:35,width:4,height:5,gap:0},Te={left:18,up:35,width:4,height:5,gap:0},je={left:24,up:35,width:4,height:5,gap:0},Ce={left:30,up:35,width:4,height:5,gap:0},We={left:36,up:35,width:4,height:5,gap:0},Ke={left:42,up:35,width:5,height:5,gap:0},Ue={left:48,up:35,width:4,height:5,gap:0},Xe={left:54,up:35,width:4,height:5,gap:0},Ze={left:60,up:35,width:4,height:5,gap:0},He={left:0,up:0,width:4,height:1,gap:0},Je={left:90,up:35,width:4,height:5,gap:0},Ne={left:24,up:0,width:5,height:5,gap:0},Oe={left:90,up:25,width:4,height:1,gap:4},Qe={0:{left:0,up:7,width:4,height:5,gap:0},1:{left:6,up:7,width:4,height:5,gap:0},2:{left:12,up:7,width:4,height:5,gap:0},3:{left:18,up:7,width:4,height:5,gap:0},4:{left:24,up:7,width:4,height:5,gap:0},5:{left:30,up:7,width:4,height:5,gap:0},6:{left:36,up:7,width:4,height:5,gap:0},7:{left:42,up:7,width:4,height:5,gap:0},8:{left:48,up:7,width:4,height:5,gap:0},9:{left:54,up:7,width:4,height:5,gap:0},props:Jt,A:Nt,B:Ot,C:Qt,D:Vt,E:Yt,F:te,G:ee,H:se,I:ie,J:he,K:ae,L:ne,M:pe,N:le,O:ge,P:de,Q:oe,R:re,S:ce,T:ue,U:we,V:fe,W:_e,X:ye,Y:me,Z:be,a:$e,b:xe,c:ke,d:qe,e:ve,f:Me,g:ze,h:Pe,i:Fe,j:Ae,k:Ee,l:Ie,m:De,n:Le,o:Re,p:Se,q:Be,r:Ge,s:Te,t:je,u:Ce,v:We,w:Ke,x:Ue,y:Xe,z:Ze,space:He,irregular:Je,"!":{left:6,up:0,width:4,height:5,gap:0},'"':{left:12,up:0,width:3,height:2,gap:0},"#":{left:18,up:0,width:5,height:5,gap:0},$:Ne,"%":{left:30,up:1,width:4,height:4,gap:1},"&":{left:36,up:0,width:5,height:5,gap:0},"'":{left:42,up:0,width:1,height:2,gap:-3},"(":{left:48,up:0,width:3,height:5,gap:0},")":{left:54,up:0,width:3,height:5,gap:0},"*":{left:60,up:0,width:5,height:5,gap:0},"+":{left:66,up:0,width:5,height:5,gap:0},",":{left:72,up:3,width:1,height:2,gap:3},"-":{left:78,up:2,width:5,height:1,gap:0},".":{left:84,up:4,width:1,height:1,gap:4},"/":{left:90,up:1,width:4,height:4,gap:1},":":{left:60,up:8,width:1,height:3,gap:0},";":{left:66,up:8,width:1,height:4,gap:1},"<":{left:72,up:7,width:3,height:5,gap:0},"=":{left:78,up:8,width:5,height:3,gap:0},">":{left:84,up:7,width:3,height:5,gap:0},"?":{left:90,up:7,width:4,height:5,gap:0},"@":{left:0,up:14,width:4,height:5,gap:0},"[":{left:66,up:21,width:4,height:5,gap:0},"\\":{left:72,up:22,width:4,height:4,gap:1},"]":{left:78,up:21,width:4,height:5,gap:0},"^":{left:84,up:21,width:5,height:3,gap:-1},_:Oe,"`":{left:0,up:27,width:1,height:2,gap:-5},"{":{left:66,up:35,width:3,height:5,gap:0},"|":{left:72,up:35,width:1,height:5,gap:0},"}":{left:78,up:35,width:3,height:5,gap:0},"~":{left:84,up:35,width:4,height:2,gap:-3}},Ve=(i,t)=>{const u={en:Ht,status:Qe};let w={};class n{constructor(g){this.name=g}delete(){delete w[this.name]}}class e extends n{constructor(g,d,o,h,l,f,r){super(g),this._={all_str:r.reduce((c,b)=>c+b.str,""),now:[{str:"",color:r[0].color,spacing_x:r[0].spacing_x,spacing_y:r[0].spacing_y}],len_allow:0,count:0,current_char:0,current_char_true:0},this.x=d,this.y=o,this.direction=h,this.size=l,this.data=r,this.font=(c=>{switch(c){case"status":return u.status;default:return u.en}})(f),w[g]=this,this.process()}write(){const g=this.size,d=this.direction*Math.PI/180,o=this._.now.reduce((c,b)=>c+b.str.length,0);let h=0,l=0,f=0;const r=c=>c in this.font?this.font[c]:this.font.space;return this._.now.forEach(c=>{c.str.split("").forEach($=>{const m=r($);$==`
`?(h=0,l+=this.font.props.height_basic+c.spacing_y):(i.stamp(this.font.props.name+"_"+c.color,this.x+(Math.cos(d)*h-Math.sin(d)*(l+m.gap/2))*g/100,this.y+(Math.sin(d)*h+Math.cos(d)*(l+m.gap/2))*g/100,this.direction,g,1,"start",{left:m.left,top:m.up,width:m.width,height:m.height}),f+1<o&&(h+=m.width+this.font.props.width_basic+c.spacing_x)),f++})}),this}process(){const g=this.data.reduce((d,o)=>d+o.str.length,0);if(this._.len_allow==g&&t.z){delete w[this.name];return}else t.x?(this._.len_allow=g,this._.current_char=g):this._.len_allow<g&&(this._.len_allow+=1/this.data[this._.count].speed,this._.current_char+=1/this.data[this._.count].speed);for(;this._.current_char_true<Math.min(this._.len_allow,g);)for(this._.now[this._.count].str+=this.data[this._.count].str[this._.now[this._.count].str.length],this._.current_char_true++;this.data[this._.count].str.length<=this._.now[this._.count].str.length&&this._.count+1<this.data.length;)this._.count++,this._.now.push({str:"",color:this.data[this._.count].color===void 0?"white":this.data[this._.count].color,spacing_x:this.data[this._.count].spacing_x,spacing_y:this.data[this._.count].spacing_y}),this._.current_char-=this.data[this._.count].str.length}}class s extends n{constructor(g,d,o,h,l,f,r,c,b,$,m){super(g),this.str_now="",this.len_now=0,this.str=d,this.x=o,this.y=h,this.direction=l,this.size=f,this.color=r,this.spacing_x=c,this.spacing_y=b,this.speed=$,this.font=(k=>{switch(k){case"status":return u.status;default:return u.en}})(m),this.len_allow=0,w[g]=this,this.process()}write(){const g=this.str_now,d=this.size,o=this.direction*Math.PI/180;let h,l;[h,l]=[0,0];const f=r=>r in this.font?this.font[r]:this.font.space;for(let r=0;r<g.length;r++){const c=f(g[r]);g[r]==`
`?(h=0,l+=this.font.props.height_basic+this.spacing_y):(i.stamp(this.font.props.name+"_"+(this.color?this.color:"white"),this.x+(Math.cos(o)*h-Math.sin(o)*(l-c.gap))*d/100,this.y+(Math.sin(o)*h+Math.cos(o)*(l-c.gap))*d/100,this.direction,d,1,"start",{left:c.left,top:c.up,width:c.width,height:c.height}),r+1<g.length&&(h+=c.width+this.font.props.width_basic+this.spacing_x))}return this}process(){if(this.len_allow==this.str.length&&t.z){delete w[this.name];return}else t.x?this.len_allow=this.str.length:this.len_allow<this.str.length&&(this.len_allow+=1/this.speed);for(;this.str_now.length<Math.min(this.len_allow,this.str.length);)this.str_now+=this.str[this.str_now.length]}}return{Super:e,Plane:s,process:()=>{for(const p in w)w[p].process()},dict:w}},Ye=(i,t)=>{class u{constructor(s,a,p,g,d,o,h=4){this.dx=s,this.dy=a,this.dd=p,this.len=g,this.align=d,this.width=h,this.soul_size=6,this.relative=o||(()=>{const l=this.dd,f=t.x-this.dx;return(t.y-this.dy)*y(l)+f*_(l)>0?"plus":"minus"})()}judge(){const s=this.dd,a=t.x-this.dx,p=t.y-this.dy,g=a*y(s)+p*-_(s),d=p*y(s)+a*_(s);if(this.len/2>g&&g>-this.len/2){if(this.relative=="minus"&&d>-(this.width/2+this.soul_size)||this.relative=="plus"&&this.width/2+this.soul_size>d){const o=g*y(-s)+(this.width/2+this.soul_size)*(this.relative=="minus"?1:-1)*_(-s),h=(this.width/2+this.soul_size)*(this.relative=="minus"?1:-1)*-y(-s)+g*_(-s);t.x=o+this.dx,t.y=h+this.dy}}else d>0?this.relative="plus":this.relative="minus"}draw(){i.drawRect(this.dx,this.dy,this.len,this.width,"white",this.dd,"center++")}}class w{constructor(s,a,p,g=4){this.dx=s,this.dy=a,this.dd=p,this.width=g}judge(){const s=this.dd,a=t.x-this.dx,p=t.y-this.dy,g=a*y(s)+p*-_(s);if(p*y(s)+a*_(s)>-this.width){const o=g*y(-s)+this.width*_(-s),h=this.width*-y(-s)+g*_(-s);t.x=o+this.dx,t.y=h+this.dy}}draw(){const s=this.dx+320*_(this.dd),a=this.dy+320*y(this.dd);i.drawRect(s,a,640,640,"#ffffff88",this.dd,"center++")}}const n={center_x:320,center_y:240,dire:0,width:100,height:100,thickness:6,walls:[],draw(){this.walls.forEach(e=>{const s=e.dx+640*_(e.dd),a=e.dy+640*y(e.dd);i.drawRect(s,a,1280,1280,"#ffffff",e.dd,"center++")}),this.walls.forEach(e=>{const s=e.dx+640*_(e.dd),a=e.dy+640*y(e.dd);i.drawRect(s,a,1280-e.width*2,1280-e.width*2,"#000000",e.dd,"center++")})},judge(){this.walls.forEach(e=>{e.judge()})},update(){{const e=this.dire,s=this.center_x,a=this.center_y,p=this.walls[0];p.dd=e,p.dx=s+this.height/2*_(e),p.dy=a+this.height/2*y(e)}{const e=this.dire+90,s=this.center_x,a=this.center_y,p=this.walls[1];p.dd=e,p.dx=s+this.height/2*_(e),p.dy=a+this.height/2*y(e)}{const e=this.dire+180,s=this.center_x,a=this.center_y,p=this.walls[2];p.dd=e,p.dx=s+this.height/2*_(e),p.dy=a+this.height/2*y(e)}{const e=this.dire+270,s=this.center_x,a=this.center_y,p=this.walls[3];p.dd=e,p.dx=s+this.height/2*_(e),p.dy=a+this.height/2*y(e)}},init(){this.walls.push(new w(0,0,0,this.thickness)),this.walls.push(new w(0,0,90,this.thickness)),this.walls.push(new w(0,0,180,this.thickness)),this.walls.push(new w(0,0,270,this.thickness))}};return n.init(),{Wall:u,box:n}},ts=async()=>{const i=await R(W),t=new i.Sprite(320,240,0,80,"soul",!0),u=K(i.cLib,i.Sprite),w=Ve(i.cLib,i.inputKeys),n=Ye(i.cLib,t);new u.normal(60,180,0,12,200,0,0,2,0,0);const e=n.box;let s=new w.Plane("test","Hello, world!",60,180,0,400,"white",0,0,5,"en");i.loop(()=>{i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height),i.inputKeys.up&&(t.y+=3.5),i.inputKeys.down&&(t.y-=3.5),i.inputKeys.right&&(t.x+=3.5),i.inputKeys.left&&(t.x-=3.5),e.dire+=1,e.draw(),e.judge(),e.update(),u.process(),w.process(),s.write(),t.stamp()})};window.onload=ts;
